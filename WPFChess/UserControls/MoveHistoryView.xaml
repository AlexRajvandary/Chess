<UserControl x:Class="ChessWPF.UserControls.MoveHistoryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:viewModels="clr-namespace:ChessWPF.ViewModels"
             xmlns:userControls="clr-namespace:ChessWPF.UserControls"
             mc:Ignorable="d" 
             d:DataContext="{d:DesignInstance viewModels:MainViewModel, IsDesignTimeCreatable=True}">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="250"/>
        </Grid.ColumnDefinitions>

        <!-- Chess Board -->
        <userControls:ChessBoardView Grid.Row="0" Grid.Column="0" DataContext="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Window}}"/>

        <!-- Algebraic Notation Display - Right Panel -->
        <Border Grid.Row="0" Grid.Column="1" Background="#F5F5F5" Padding="15" Margin="10,10,10,10" BorderBrush="#DDD" BorderThickness="1" CornerRadius="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Move History" FontWeight="Bold" FontSize="14" Margin="0,0,0,15" Foreground="#2C3E50"/>
                    <Border Grid.Column="1" 
                            Background="#4A90E2" 
                            Padding="6,3" 
                            CornerRadius="3"
                            Margin="0,0,0,15"
                            Visibility="{Binding IsGameLoaded, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <TextBlock Text="READ ONLY" 
                                   FontSize="9" 
                                   FontWeight="Bold" 
                                   Foreground="White"
                                   VerticalAlignment="Center"/>
                    </Border>
                </Grid>

                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled"
                              Background="White" BorderBrush="#DDD" BorderThickness="1" Padding="10">
                    <Border Background="#F8F8F8" BorderBrush="#E0E0E0" BorderThickness="1" Padding="8">
                        <ItemsControl ItemsSource="{Binding MoveHistoryItems}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="0,2">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <!-- Move Number -->
                                        <TextBlock Grid.Column="0" 
                                                   Text="{Binding MoveNumber, StringFormat='{}{0}.'}" 
                                                   FontFamily="Consolas" 
                                                   FontSize="12" 
                                                   Foreground="#666"
                                                   Margin="0,0,10,0"
                                                   VerticalAlignment="Center"
                                                   MinWidth="30"/>
                                        
                                        <!-- White Move -->
                                        <TextBlock Grid.Column="1" 
                                                   Text="{Binding WhiteMoveText}" 
                                                   FontFamily="Consolas" 
                                                   FontSize="12" 
                                                   LineHeight="20"
                                                   Margin="0,0,5,0"
                                                   Cursor="Hand"
                                                   VerticalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="#333"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsWhiteSelected}" Value="True">
                                                            <Setter Property="Background" Value="#4A90E2"/>
                                                            <Setter Property="Foreground" Value="White"/>
                                                            <Setter Property="FontWeight" Value="Bold"/>
                                                            <Setter Property="Padding" Value="3,1"/>
                                                        </DataTrigger>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#E3F2FD"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                            <TextBlock.InputBindings>
                                                <MouseBinding Gesture="LeftClick" Command="{Binding SelectWhiteMoveCommand}"/>
                                            </TextBlock.InputBindings>
                                        </TextBlock>
                                        
                                        <!-- Black Move -->
                                        <TextBlock Grid.Column="2" 
                                                   Text="{Binding BlackMoveText}" 
                                                   FontFamily="Consolas" 
                                                   FontSize="12" 
                                                   LineHeight="20"
                                                   Cursor="Hand"
                                                   VerticalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="#333"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsBlackSelected}" Value="True">
                                                            <Setter Property="Background" Value="#4A90E2"/>
                                                            <Setter Property="Foreground" Value="White"/>
                                                            <Setter Property="FontWeight" Value="Bold"/>
                                                            <Setter Property="Padding" Value="3,1"/>
                                                        </DataTrigger>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Background" Value="#E3F2FD"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                            <TextBlock.InputBindings>
                                                <MouseBinding Gesture="LeftClick" Command="{Binding SelectBlackMoveCommand}"/>
                                            </TextBlock.InputBindings>
                                        </TextBlock>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </Border>
                </ScrollViewer>

                <!-- Navigation buttons at bottom -->
                <StackPanel Grid.Row="3" 
                            Orientation="Horizontal" 
                            HorizontalAlignment="Center"
                            Margin="0,10,0,0"
                            Visibility="{Binding IsGameLoaded, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Button Content="◄"
                            Command="{Binding PreviousMoveCommand}"
                            Background="#4A90E2"
                            Foreground="White"
                            FontSize="14"
                            FontWeight="Bold"
                            Padding="12,5"
                            Margin="0,0,10,0"
                            BorderThickness="0"
                            Cursor="Hand"
                            MinWidth="40"
                            MinHeight="30">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}"
                                        CornerRadius="3"
                                        Padding="{TemplateBinding Padding}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    
                    <Button Content="{Binding AutoPlayButtonText}"
                            Command="{Binding ToggleAutoPlayCommand}"
                            Foreground="White"
                            FontSize="11"
                            FontWeight="Bold"
                            Padding="15,5"
                            Margin="0,0,10,0"
                            BorderThickness="0"
                            Cursor="Hand"
                            MinWidth="80"
                            MinHeight="30">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="#4A90E2"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsAutoPlaying}" Value="True">
                                        <Setter Property="Background" Value="#E74C3C"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}"
                                        CornerRadius="3"
                                        Padding="{TemplateBinding Padding}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                    
                    <Button Content="►"
                            Command="{Binding NextMoveCommand}"
                            Background="#4A90E2"
                            Foreground="White"
                            FontSize="14"
                            FontWeight="Bold"
                            Padding="12,5"
                            BorderThickness="0"
                            Cursor="Hand"
                            MinWidth="40"
                            MinHeight="30">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}"
                                        CornerRadius="3"
                                        Padding="{TemplateBinding Padding}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- FEN Notation Display - Bottom Panel -->
        <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Background="#F5F5F5" Padding="15" Margin="10,5,10,10" BorderBrush="#DDD" BorderThickness="1" CornerRadius="5">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0" Text="FEN Notation:" FontWeight="Bold" FontSize="12" Margin="0,0,0,8" Foreground="#2C3E50"/>
                <Border Grid.Row="1" Background="#F8F8F8" BorderBrush="#E0E0E0" BorderThickness="1" Padding="8">
                    <TextBlock Text="{Binding DataContext.Game.Fen, RelativeSource={RelativeSource AncestorType=Window}}" FontFamily="Consolas" TextWrapping="Wrap" FontSize="11" />
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>

