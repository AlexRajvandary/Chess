# –ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º Chess Application

> üìã **–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫—É**

---

## üìë –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [üìä –õ–µ–≥–µ–Ω–¥–∞ –¥–∏–∞–≥—Ä–∞–º–º](#-–ª–µ–≥–µ–Ω–¥–∞-–¥–∏–∞–≥—Ä–∞–º–º)
2. [üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞](#-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è-—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
3. [‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π API –±–∏–±–ª–∏–æ—Ç–µ–∫–∏](#-–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π-api-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏-–ø—Ä–∏–Ω—Ü–∏–ø—ã-–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
   - [üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã](#-–æ—Å–Ω–æ–≤–Ω—ã–µ-–ø—Ä–∏–Ω—Ü–∏–ø—ã)
   - [üìê –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π API](#-–ø—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π-api)
   - [üîÑ –¢–∏–ø–∏—á–Ω—ã–π –ø–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã](#-—Ç–∏–ø–∏—á–Ω—ã–π-–ø–æ—Ç–æ–∫-—Ä–∞–±–æ—Ç—ã)
   - [üí° –ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏?](#-—á—Ç–æ-–≤–æ–∑–≤—Ä–∞—â–∞—Ç—å-–≤-—Å–æ—Å—Ç–æ—è–Ω–∏–∏)
4. [üîç –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#-–≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)
   - [1. ‚ö° –ö–∞—Å–∫–∞–¥–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏ –ø–µ—Ä–µ—Å—á–µ—Ç—ã](#1--–∫–∞—Å–∫–∞–¥–Ω—ã–µ-–≤—ã–∑–æ–≤—ã-–∏-–ø–µ—Ä–µ—Å—á–µ—Ç—ã-–≤-–±–∏–±–ª–∏–æ—Ç–µ–∫–µ)
   - [2. üî¥ –ù–∞—Ä—É—à–µ–Ω–∏–µ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏ –≤ Game](#2--–Ω–∞—Ä—É—à–µ–Ω–∏–µ-–∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏-–≤-game)
   - [3. üî¥ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è](#3--–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ-–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏-–¥–ª—è-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è)
   - [4. ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è](#4--–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ-–º–æ–¥–µ–ª–µ–π-—Å–æ—Å—Ç–æ—è–Ω–∏—è)
   - [5. ‚ö†Ô∏è –°–º–µ—à–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –≤ GameViewModel](#5--—Å–º–µ—à–µ–Ω–∏–µ-–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏-–≤-gameviewmodel)
   - [6. üî¥ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –æ–±—Ö–æ–¥ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏](#6--–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ-–∏–≥—Ä—ã-—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ-–≤-–æ–±—Ö–æ–¥-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏)
   - [7. üî¥ –ü—Ä–æ–±–ª–µ–º—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∏–≥—É—Ä –∏ –∫–∞—Å–∫–∞–¥–Ω—ã–µ –≤—ã–∑–æ–≤—ã](#7--–ø—Ä–æ–±–ª–µ–º—ã-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏-—Ñ–∏–≥—É—Ä-–∏-–∫–∞—Å–∫–∞–¥–Ω—ã–µ-–≤—ã–∑–æ–≤—ã)
   - [8. üî¥ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ö–æ–¥–æ–≤ –∏ En Passant](#8--–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ-–ª–æ–≥–∏–∫–∏-–ø–æ–ª—É—á–µ–Ω–∏—è-–¥–æ—Å—Ç—É–ø–Ω—ã—Ö-—Ö–æ–¥–æ–≤-–∏-en-passant)
   - [9. ‚ÑπÔ∏è IView - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç](#9--iview---—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç-–Ω–µ-–ø—Ä–æ–±–ª–µ–º–∞)
5. [üìê –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ ChessLib](#-–ø–æ–¥—Ä–æ–±–Ω—ã–π-–∞–Ω–∞–ª–∏–∑-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏-chesslib)
   - [–¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏](#—Ç–µ–∫—É—â–∞—è-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏)
   - [–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](#–ø—Ä–æ–±–ª–µ–º—ã-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
   - [–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏](#–ø—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏)
   - [–£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)](#—É–ª—É—á—à–µ–Ω–Ω–∞—è-–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å-—Å-–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
6. [üèóÔ∏è –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (WPF ‚Üî Library)](#Ô∏è-—Ç–µ–∫—É—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-wpf--library)
7. [üìê –ü–æ–ª–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (—É—Ä–æ–≤–µ–Ω—å –∫–ª–∞—Å—Å–æ–≤)](#-–ø–æ–ª–Ω—ã–µ-–¥–∏–∞–≥—Ä–∞–º–º—ã-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã-—É—Ä–æ–≤–µ–Ω—å-–∫–ª–∞—Å—Å–æ–≤)
   - [üî¥ –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (WPF ‚Üî ChessLib)](#-—Ç–µ–∫—É—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-wpf--chesslib)
   - [‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (WPF ‚Üî ChessLib)](#-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-wpf--chesslib)
   - [üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π](#-—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π)
8. [‚ú® –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#-–ø—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
9. [üìã –ü–æ—ç—Ç–∞–ø–Ω—ã–π –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞](#-–ø–æ—ç—Ç–∞–ø–Ω—ã–π-–ø–ª–∞–Ω-—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
   - [üéØ –û–±—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è](#-–æ–±—â–∞—è-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è)
   - [üìç –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#-—ç—Ç–∞–ø-1-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–∏-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
   - [üìç –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ](#-—ç—Ç–∞–ø-2-—Å–æ–∑–¥–∞–Ω–∏–µ-–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π-–≤-–±–∏–±–ª–∏–æ—Ç–µ–∫–µ)
   - [üìç –≠—Ç–∞–ø 3: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Game ‚Üí GameEngine —Å CQRS + Strategy Pattern](#-—ç—Ç–∞–ø-3-—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥-game--gameengine-—Å-cqrs--strategy-pattern)
   - [üìç –≠—Ç–∞–ø 4: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ —Ö–æ–¥–æ–≤](#-—ç—Ç–∞–ø-4-—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è-–ª–æ–≥–∏–∫–∏-—Ö–æ–¥–æ–≤-–∏-en-passant)
   - [üìç –≠—Ç–∞–ø 5: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä—ã](#-—ç—Ç–∞–ø-5-–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-–º–µ—Ç–æ–¥–æ–≤-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è-–∏–≥—Ä—ã-–≤-–±–∏–±–ª–∏–æ—Ç–µ–∫—É)
   - [üìç –≠—Ç–∞–ø 6: –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è BoardState](#-—ç—Ç–∞–ø-6-–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è-boardstate)
   - [üìç –≠—Ç–∞–ø 7: –°–æ–∑–¥–∞–Ω–∏–µ IGameService –≤ Application —Å–ª–æ–µ](#-—ç—Ç–∞–ø-7-—Å–æ–∑–¥–∞–Ω–∏–µ-igameservice-–≤-application-—Å–ª–æ–µ)
   - [üìç –≠—Ç–∞–ø 8: –ú–∏–≥—Ä–∞—Ü–∏—è WPF –Ω–∞ IGameService](#-—ç—Ç–∞–ø-8-–º–∏–≥—Ä–∞—Ü–∏—è-wpf-–Ω–∞-igameservice)
   - [üìç –≠—Ç–∞–ø 9: –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–æ–¥–∞](#-—ç—Ç–∞–ø-9-—É–¥–∞–ª–µ–Ω–∏–µ-—É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ-–∫–æ–¥–∞)
   - [üìç –≠—Ç–∞–ø 10: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#-—ç—Ç–∞–ø-10-—Ñ–∏–Ω–∞–ª—å–Ω–∞—è-–ø—Ä–æ–≤–µ—Ä–∫–∞-–∏-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
10. [üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —ç—Ç–∞–ø–æ–≤](#-—Å–≤–æ–¥–Ω–∞—è-—Ç–∞–±–ª–∏—Ü–∞-—ç—Ç–∞–ø–æ–≤)
11. [üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã](#-–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞-–ø—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–π-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)
12. [üîÆ –ë—É–¥—É—â–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–Ω–µ —Å–µ–π—á–∞—Å)](#-–±—É–¥—É—â–∏–µ-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏-–Ω–µ-—Å–µ–π—á–∞—Å)
    - [Bitboards](#bitboards)
13. [‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è](#Ô∏è-–≤–∞–∂–Ω—ã–µ-–∑–∞–º–µ—á–∞–Ω–∏—è)
    - [–ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞](#–ø—Ä–∏–Ω—Ü–∏–ø—ã-—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
    - [–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º](#–ø–µ—Ä–µ–¥-–Ω–∞—á–∞–ª–æ–º)
    - [–í–æ –≤—Ä–µ–º—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞](#–≤–æ-–≤—Ä–µ–º—è-—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
    - [–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞](#–ø–æ—Å–ª–µ-—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)

---

## üìä –õ–µ–≥–µ–Ω–¥–∞ –¥–∏–∞–≥—Ä–∞–º–º

### –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞

| –¶–≤–µ—Ç | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| üî¥ **–ö—Ä–∞—Å–Ω—ã–π** | –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–Ω–∞—Ä—É—à–µ–Ω–∏—è –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å) |
| üü° **–ñ–µ–ª—Ç—ã–π** | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è |
| üü¢ **–ó–µ–ª–µ–Ω—ã–π** | –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏) |
| üîµ **–°–∏–Ω–∏–π** | WPF —Å–ª–æ–π (Presentation) |
| üü† **–û—Ä–∞–Ω–∂–µ–≤—ã–π** | Domain —Å–ª–æ–π (ChessLib) |
| üü¢ **–°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π** | Console –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| ‚ö™ **–°–µ—Ä—ã–π** | –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ) |

### –°–∏–º–≤–æ–ª—ã

- ‚ö†Ô∏è ‚Äî –ü—Ä–æ–±–ª–µ–º–∞ –∏–ª–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- ‚úÖ ‚Äî –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- üî¥ ‚Äî –ü—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å (–ø—Ä–æ–±–ª–µ–º–∞)
- ‚ö° ‚Äî –ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- üîÑ ‚Äî –ö–∞—Å–∫–∞–¥–Ω—ã–µ –≤—ã–∑–æ–≤—ã

---

## üéØ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

1. **üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π**: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (ChessLib)
   - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
   - –£–ª—É—á—à–µ–Ω–∏–µ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏
   - –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –±—É–¥—É—â–∏–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º (bitboards)

2. **üü° –í—ã—Å–æ–∫–∏–π**: –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è View ‚Üî Library
   - –°–æ–∑–¥–∞–Ω–∏–µ `IGameService`
   - –£–±—Ä–∞—Ç—å –ø—Ä—è–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ WPF –æ—Ç ChessLib

3. **üü¢ –°—Ä–µ–¥–Ω–∏–π**: –£–ø—Ä–æ—â–µ–Ω–∏–µ WPF —Å–ª–æ—è
   - –£–±—Ä–∞—Ç—å `BoardStateSnapshot`
   - –í—ã–Ω–µ—Å—Ç–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏–∑ ViewModels

### –¶–µ–ª—å

**–°–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –ø—Ä–∏ –±—É–¥—É—â–∏—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (bitboards, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç.–¥.) WPF –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π.**

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π API –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–ø—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

### üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

**–í—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤—ã!** –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

1. **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: –¢–æ–ª—å–∫–æ `from` –∏ `to` –ø–æ–∑–∏—Ü–∏–∏
   - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –∑–Ω–∞—Ç—å –ø—Ä–æ UI —Å–æ–±—ã—Ç–∏—è, –∫–ª–∏–∫–∏ –º—ã—à–∏ –∏ —Ç.–¥.
   - –ü—Ä–æ—Å—Ç–æ–π, –ø–æ–Ω—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: `MakeMove(Position from, Position to)`

2. **–í—Å—è –ª–æ–≥–∏–∫–∞ –≤–Ω—É—Ç—Ä–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**:
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ö–æ–¥–∞
   - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ö–æ–¥–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —à–∞—Ö/–º–∞—Ç
   - –°–º–µ–Ω–∞ –∏–≥—Ä–æ–∫–∞
   - –í—Å—è –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω–∞

3. **–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ**:
   - `MoveResult` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ø—ã—Ç–∫–∏ —Ö–æ–¥–∞ (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞, —Ç–∏–ø —Ö–æ–¥–∞, —à–∞—Ö/–º–∞—Ç)
   - `IGameState` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã (–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–º –≤—ã–∑–æ–≤–æ–º `GetState()`)

### üìê –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–π API

```csharp
public interface IGameEngine
{
    // –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ö–æ–¥–∞
    MoveResult MakeMove(Position from, Position to);
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
    IGameState GetState();
    
    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è UI
    IReadOnlyList<Position> GetValidMoves(Position from);
    string GetFen();
    string GetMoveHistory();
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–π
    void StartNewGame();
    void EndGameByTime(PieceColor losingColor);
}
```

### üîÑ –¢–∏–ø–∏—á–Ω—ã–π –ø–æ—Ç–æ–∫ —Ä–∞–±–æ—Ç—ã

```mermaid
sequenceDiagram
    autonumber
    participant UI
    participant IGameEngine
    participant GameEngine
    
    Note over UI,GameEngine: ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
    
    activate UI
    UI->>+IGameEngine: GetValidMoves(from)
    IGameEngine-->>-UI: List~Position~
    deactivate UI
    
    activate UI
    UI->>+IGameEngine: MakeMove(from, to)
    activate IGameEngine
    IGameEngine->>+GameEngine: MakeMove(from, to)
    Note right of GameEngine: –í—Å—è –ª–æ–≥–∏–∫–∞ –≤–Ω—É—Ç—Ä–∏:<br/>- –í–∞–ª–∏–¥–∞—Ü–∏—è<br/>- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ<br/>- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è<br/>- –ü—Ä–æ–≤–µ—Ä–∫–∞ —à–∞—Ö/–º–∞—Ç
    GameEngine-->>-IGameEngine: MoveResult
    deactivate IGameEngine
    IGameEngine-->>-UI: MoveResult
    deactivate UI
    
    alt Move successful
        activate UI
        UI->>+IGameEngine: GetState()
        IGameEngine-->>-UI: IGameState
        Note right of UI: –û–±–Ω–æ–≤–ª—è–µ—Ç UI –Ω–∞ –æ—Å–Ω–æ–≤–µ<br/>–Ω–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        deactivate UI
    end
```

### üí° –ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏?

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∞–ª–∞)**
```csharp
public interface IGameState
{
    PieceColor CurrentPlayerColor { get; }
    bool IsCheck { get; }
    bool IsCheckmate { get; }
    bool IsGameOver { get; }
    IReadOnlyList<IPieceInfo> Pieces { get; } // –í—Å–µ —Ñ–∏–≥—É—Ä—ã –Ω–∞ –¥–æ—Å–∫–µ
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ UI –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- ‚úÖ –õ–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω–æ (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ñ–∏–≥—É—Ä–∞)

**–í–∞—Ä–∏–∞–Ω—Ç 2: –¢–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤ –±—É–¥—É—â–µ–º)**
```csharp
public interface IMoveResult
{
    bool IsValid { get; }
    MoveType MoveType { get; }
    PositionChanged[] ChangedPositions { get; } // –¢–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
    bool IsCheck { get; }
    bool IsCheckmate { get; }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ (–º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö)
- ‚úÖ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–∏–≤—à–∏–µ—Å—è –∫–ª–µ—Ç–∫–∏

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏**:
- ‚ö†Ô∏è –°–ª–æ–∂–Ω–µ–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
- ‚ö†Ô∏è UI –¥–æ–ª–∂–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–î–ª—è –Ω–∞—á–∞–ª–∞**: –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ `GetState()`

**–í –±—É–¥—É—â–µ–º**: –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –¥–æ–±–∞–≤–∏–≤ –º–µ—Ç–æ–¥ `GetStateChanges()` –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –Ω–æ —ç—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥.

**–í–∞–∂–Ω–æ**: UI –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –ø—Ä–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏. –û–Ω –ø–æ–ª—É—á–∞–µ—Ç:
- `MoveResult` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ö–æ–¥–∞
- `IGameState` - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
- `IReadOnlyList<Position>` - –≤–∞–ª–∏–¥–Ω—ã–µ —Ö–æ–¥—ã

–í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ (–≤–∞–ª–∏–¥–∞—Ü–∏—è, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ) - –≤–Ω—É—Ç—Ä–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏!

---

## üîç –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ö° **–ö–∞—Å–∫–∞–¥–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏ –ø–µ—Ä–µ—Å—á–µ—Ç—ã –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é –∏–≥—Ä—ã –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç –¥–æ—Å–∫–∏

**–î–µ—Ç–∞–ª–∏**:
- `GetState()` –≤—ã–∑—ã–≤–∞–µ—Ç `GetGameField()` ‚Üí —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π `string[8,8]` –∫–∞–∂–¥—ã–π —Ä–∞–∑
- `UpdateGameField()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —á–∞—Å—Ç–æ –∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∞—Ç–∞–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Ñ–∏–≥—É—Ä
- `GetValidMoves()` –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∏–≥—É—Ä—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å—é –¥–æ—Å–∫—É
- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∏–≥—É—Ä—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ—Å–∫–∏

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- ‚ö° –ù–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚ö° –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
- üî¥ –°–ª–æ–∂–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–≤—Å–µ —Å–≤—è–∑–∞–Ω–æ)

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã**:
```csharp
// –í GetValidMoves –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∏–≥—É—Ä—ã:
var gameFieldString = GetGameField(Pieces); // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤
var possibleMoves = piece.AvailableMoves(gameFieldString); // –ü–µ—Ä–µ—Å—á–µ—Ç
```

### 2. üî¥ **–ù–∞—Ä—É—à–µ–Ω–∏–µ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏ –≤ Game**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—É–±–ª–∏—á–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –∏ –º–µ—Ç–æ–¥—ã –¥–∞—é—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º

**–î–µ—Ç–∞–ª–∏**:
- `public List<IPiece> Pieces` - –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ —Å–ø–∏—Å–∫—É —Ñ–∏–≥—É—Ä
- `public GameField GameField` - –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é
- `public List<Player> Players` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∏–¥–Ω–∞ —Å–Ω–∞—Ä—É–∂–∏

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- üî¥ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ bitboards)
- üî¥ WPF –∑–Ω–∞–µ—Ç –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç—è—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- üî¥ –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### 3. üî¥ **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è**

**–ü—Ä–æ–±–ª–µ–º–∞**: WPF –Ω–∞–ø—Ä—è–º—É—é –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `Game` –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä

**–î–µ—Ç–∞–ª–∏**:
- WPF –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ChessGameService`, –∫–æ—Ç–æ—Ä—ã–π –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç `Game`
- –ù–æ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `IGameService`
- WPF –∑–Ω–∞–µ—Ç –ø—Ä–æ `IPiece`, `Position`, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- üî¥ –¢–µ—Å–Ω–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å
- üî¥ –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å WPF
- üî¥ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤

### 4. ‚ö†Ô∏è **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —Å–æ—Å—Ç–æ—è–Ω–∏—è**

**–ü—Ä–æ–±–ª–µ–º–∞**: WPF —Å–æ–∑–¥–∞–µ—Ç `BoardStateSnapshot`, –∫–æ—Ç–æ—Ä—ã–π –¥—É–±–ª–∏—Ä—É–µ—Ç `GameState`

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- üî¥ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–ª–æ–π –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
- üî¥ –†–∏—Å–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- üî¥ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

### 5. ‚ö†Ô∏è **–°–º–µ—à–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –≤ GameViewModel**

**–ü—Ä–æ–±–ª–µ–º–∞**: `GameViewModel` —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- üî¥ –ù–∞—Ä—É—à–µ–Ω–∏–µ SRP
- üî¥ –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 6. üî¥ **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –æ–±—Ö–æ–¥ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**

**–ü—Ä–æ–±–ª–µ–º–∞**: –õ–æ–≥–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä—ã –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ WPF —Å–ª–æ–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç—è–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:
1. **–ü–∞—Ä—Å–∏–Ω–≥ PGN –≤ WPF** (`PgnService.ParsePgnMoves`)
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ö–æ–¥–æ–≤ –≤ –∞–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–æ–π –Ω–æ—Ç–∞—Ü–∏–∏: `["e4", "e5", "Nf3", ...]`

2. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–∏–≥—Ä—ã–≤–∞–Ω–∏–µ** (`MoveHistoryViewModel.NavigateToMove`)
   ```csharp
   gameService.StartNewGame(); // –ù–æ–≤–∞—è –∏–≥—Ä–∞
   for (int i = 0; i <= moveIndex; i++)
   {
       var moveInfo = PgnMoveParser.ParseMove(moveNotation, gameService.CurrentGame);
       gameService.MakeMove(moveInfo.From, moveInfo.To); // –ü–µ—Ä–µ–∏–≥—Ä—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π —Ö–æ–¥
   }
   ```

3. **–ü–∞—Ä—Å–∏–Ω–≥ –∞–ª–≥–µ–±—Ä–∞–∏—á–µ—Å–∫–æ–π –Ω–æ—Ç–∞—Ü–∏–∏ –≤ WPF** (`PgnMoveParser`)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `game.Pieces`, `game.CurrentPlayerColor`, `game.GetValidMoves`
   - –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç—è–º `Game`

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- üî¥ –õ–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ PGN –≤ WPF —Å–ª–æ–µ - –±—ç–∫–µ–Ω–¥ –Ω–µ —Å–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- üî¥ –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ `Game.Pieces` - –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏
- ‚ö° –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å - –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ —Ö–æ–¥—É N –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∏–≥—Ä–∞—Ç—å –≤—Å–µ N —Ö–æ–¥–æ–≤
- üî¥ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ - –ø–∞—Ä—Å–∏–Ω–≥ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω –º–µ–∂–¥—É `PgnService` –∏ `PgnMoveParser`
- üî¥ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –ë–î (–Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∏–≥—Ä—ã–≤–∞—Ç—å –≤—Å–µ —Ö–æ–¥—ã)

**–†–µ—à–µ–Ω–∏–µ**: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É:
```csharp
// –í –±–∏–±–ª–∏–æ—Ç–µ–∫–µ
public interface IGameEngine
{
    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ PGN
    void LoadFromPgn(string pgn);
    void LoadFromMoves(IEnumerable<string> moves);
    
    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ FEN (–±—ã—Å—Ç—Ä–µ–µ!)
    void LoadFromFen(string fen);
    
    // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è (—Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π - –¥–ª—è –ë–î)
    void LoadFromState(IGameState state);
    
    // –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î
    string SerializeState();
    IGameState GetState();
}
```

**–í–∞–∂–Ω–æ –¥–ª—è –±—ç–∫–µ–Ω–¥–∞**: –ë—ç–∫–µ–Ω–¥ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–≥—Ä—É –∏–∑ –ë–î –±–µ–∑ –ø–µ—Ä–µ–∏–≥—Ä—ã–≤–∞–Ω–∏—è –≤—Å–µ—Ö —Ö–æ–¥–æ–≤.

### 7. üî¥ **–ü—Ä–æ–±–ª–µ–º—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∏–≥—É—Ä –∏ –∫–∞—Å–∫–∞–¥–Ω—ã–µ –≤—ã–∑–æ–≤—ã**

**–ü—Ä–æ–±–ª–µ–º–∞**: –§–∏–≥—É—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º –¥–æ—Å–∫–∏ –∏ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –∫–∞—Å–∫–∞–¥–Ω–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

1. **–ü—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `string[,]`**
   ```csharp
   public abstract List<Position> AvailableMoves(string[,] GameField);
   public abstract List<Position> AvailableKills(string[,] GameField);
   ```
   - –í—Å–µ —Ñ–∏–≥—É—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –º–∞—Å—Å–∏–≤–æ–º —Å—Ç—Ä–æ–∫
   - –ù–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ - —Å–ª–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å
   - –ù—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å –º–∞—Å—Å–∏–≤ –∫–∞–∂–¥—ã–π —Ä–∞–∑

2. **–ö–∞—Å–∫–∞–¥–Ω—ã–µ –≤—ã–∑–æ–≤—ã** (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –≤ –∫–æ–¥–µ)
   ```csharp
   // PieceBase.cs:20
   // there is a cascade calls 198 times per one piece, needs to be refactored
   ```
   - –ü—Ä–∏ –∫–∞–∂–¥–æ–º `GetValidMoves()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `GetGameField()` ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è `string[8,8]`
   - –ó–∞—Ç–µ–º –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∏–≥—É—Ä—ã –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `AvailableMoves()` –∏ `AvailableKills()`
   - –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∏–≥—É—Ä—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ—Å–∫–∏

3. **–°–º–µ—à–∏–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤**
   - `GetValidMoves()` (–∑–∞–ø—Ä–æ—Å) –≤—ã–∑—ã–≤–∞–µ—Ç `AvailableMoves()` (–∑–∞–ø—Ä–æ—Å)
   - `MakeMove()` (–∫–æ–º–∞–Ω–¥–∞) –≤—ã–∑—ã–≤–∞–µ—Ç `GetValidMoves()` (–∑–∞–ø—Ä–æ—Å) ‚Üí –∫–∞—Å–∫–∞–¥
   - –ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è - –∫–æ–º–∞–Ω–¥—ã –≤—ã–∑—ã–≤–∞—é—Ç –∑–∞–ø—Ä–æ—Å—ã, —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –∫–∞—Å–∫–∞–¥—ã

4. **–ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è**
   - –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–Ω–æ–≤–æ
   - –ù–µ—Ç –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫—ç—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

5. **–ù–∞—Ä—É—à–µ–Ω–∏–µ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏**
   - `King.ShortCastling()` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `GameField` –∏ `List<IPiece>` –Ω–∞–ø—Ä—è–º—É—é
   - –§–∏–≥—É—Ä—ã –∑–Ω–∞—é—Ç –ø—Ä–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ—Å–∫–∏

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**:
- ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: 198+ –≤—ã–∑–æ–≤–æ–≤ –Ω–∞ –æ–¥–Ω—É —Ñ–∏–≥—É—Ä—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏–≥—Ä—ã
- üî¥ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –°–ª–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å (bitboards, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- üî¥ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –°–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–≥—É—Ä—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
- üî¥ **–ì–∏–±–∫–æ—Å—Ç—å**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å–∫–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Ñ–∏–≥—É—Ä

**–†–µ—à–µ–Ω–∏–µ: CQRS (Command Query Responsibility Segregation) + –ê–±—Å—Ç—Ä–∞–∫—Ü–∏–∏**

1. **–†–∞–∑–¥–µ–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –∏ –∑–∞–ø—Ä–æ—Å—ã**
   ```csharp
   // –ö–æ–º–∞–Ω–¥—ã (–∏–∑–º–µ–Ω—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ)
   public interface IGameCommand
   {
       MoveResult Execute(IGameState state);
   }
   
   // –ó–∞–ø—Ä–æ—Å—ã (—á–∏—Ç–∞—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –Ω–µ –∏–∑–º–µ–Ω—è—é—Ç)
   public interface IGameQuery
   {
       List<Position> GetValidMoves(Position from, IGameState state);
       IGameState GetState();
   }
   ```

2. **Strategy Pattern –¥–ª—è —Ö–æ–¥–æ–≤ —Ñ–∏–≥—É—Ä**
   ```csharp
   // –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∏–≥—É—Ä—ã
   public interface IMoveStrategy
   {
       PieceType PieceType { get; }
       List<Position> GetPossibleMoves(IPiece piece, IBoardQuery board);
       List<Position> GetPossibleCaptures(IPiece piece, IBoardQuery board);
   }
   
   // –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∏–≥—É—Ä—ã
   public class PawnMoveStrategy : IMoveStrategy { }
   public class KingMoveStrategy : IMoveStrategy { }
   public class QueenMoveStrategy : IMoveStrategy { }
   public class RookMoveStrategy : IMoveStrategy { }
   public class BishopMoveStrategy : IMoveStrategy { }
   public class KnightMoveStrategy : IMoveStrategy { }
   
   // –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å–∫–∏
   public interface IBoardQuery
   {
       IPieceInfo GetPieceAt(Position position);
       bool IsCellFree(Position position);
       bool IsCellAttacked(Position position, PieceColor byColor);
   }
   
   // –§–∏–≥—É—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
   public interface IPiece
   {
       PieceType Type { get; }
       PieceColor Color { get; }
       Position Position { get; }
       bool IsDead { get; }
       // –£–±—Ä–∞—Ç—å –º–µ—Ç–æ–¥—ã AvailableMoves/AvailableKills
   }
   
   // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
   public interface IMoveStrategyRegistry
   {
       IMoveStrategy GetStrategy(PieceType pieceType);
   }
   ```

3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤**
   ```csharp
   public class GameStateCache
   {
       private IGameState _cachedState;
       private Dictionary<Position, List<Position>> _cachedValidMoves;
       
       public List<Position> GetValidMoves(Position from)
       {
           if (_cachedValidMoves.ContainsKey(from))
               return _cachedValidMoves[from];
           
           // –í—ã—á–∏—Å–ª–∏—Ç—å –∏ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞—Ç—å
           var moves = CalculateValidMoves(from);
           _cachedValidMoves[from] = moves;
           return moves;
       }
       
       public void Invalidate() // –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã
       {
           _cachedState = null;
           _cachedValidMoves.Clear();
       }
   }
   ```

4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**
   - **–ö–æ–º–∞–Ω–¥—ã** (`MakeMove`) ‚Üí –∏–∑–º–µ–Ω—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Üí –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç –∫—ç—à
   - **–ó–∞–ø—Ä–æ—Å—ã** (`GetValidMoves`) ‚Üí —á–∏—Ç–∞—é—Ç –∏–∑ –∫—ç—à–∞ ‚Üí –Ω–µ –∏–∑–º–µ–Ω—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ CQRS + Strategy Pattern**:
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ - –∑–∞–ø—Ä–æ—Å—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å - –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å - –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å–∫–∏ (bitboards)
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å - —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ç–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
- ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø—Ä–∞–≤–∏–ª
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ - —Ñ–∏–≥—É—Ä—ã —Ö—Ä–∞–Ω—è—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ - –ª–æ–≥–∏–∫—É –¥–≤–∏–∂–µ–Ω–∏—è

### 8. üî¥ **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ö–æ–¥–æ–≤ –∏ En Passant**

**–ü—Ä–æ–±–ª–µ–º–∞**: –õ–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ö–æ–¥–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ En Passant –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –º–Ω–æ–∂–µ—Å—Ç–≤–µ –º–µ—Å—Ç

**–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ö–æ–¥–æ–≤**:

1. **`GetValidMoves()` –≤ Game.cs** (—Å—Ç—Ä–æ–∫–∏ 366-368)
   ```csharp
   var possibleMoves = piece.AvailableMoves(gameFieldString);
   var possibleKills = piece.AvailableKills(gameFieldString);
   ```

2. **`IsValidMove()` –≤ MoveValidator.cs** (—Å—Ç—Ä–æ–∫–∏ 33-35)
   ```csharp
   var possibleMoves = piece.AvailableMoves(gameFieldString);
   var possibleKills = piece.AvailableKills(gameFieldString);
   ```

3. **`IsCheckmate()` –≤ Game.cs** (—Å—Ç—Ä–æ–∫–∏ 464-466)
   ```csharp
   var possibleMoves = piece.AvailableMoves(gameFieldString);
   var possibleKills = piece.AvailableKills(gameFieldString);
   ```

**–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ En Passant**:

1. **`GetValidMoves()` –¥–ª—è –ø–µ—à–∫–∏** (Game.cs:379-408)
   - –§–∏–ª—å—Ç—Ä—É–µ—Ç –≤—Å–µ —Ñ–∏–≥—É—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Ä–∞–∂–µ—Å–∫–∏—Ö –ø–µ—à–µ–∫
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ (Y == 4 –¥–ª—è –±–µ–ª—ã—Ö, Y == 3 –¥–ª—è —á–µ—Ä–Ω—ã—Ö)
   - –í—ã—á–∏—Å–ª—è–µ—Ç destination –ø–æ–∑–∏—Ü–∏—é
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—É—Å—Ç—É—é –∫–ª–µ—Ç–∫—É

2. **`TryEnPassant()`** (Game.cs:280-330)
   - –°–Ω–æ–≤–∞ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –≤—Å–µ —Ñ–∏–≥—É—Ä—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Ä–∞–∂–µ—Å–∫–∏—Ö –ø–µ—à–µ–∫
   - –°–Ω–æ–≤–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ (Y == 4 –¥–ª—è –±–µ–ª—ã—Ö, Y == 3 –¥–ª—è —á–µ—Ä–Ω—ã—Ö)
   - –°–Ω–æ–≤–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç destination –ø–æ–∑–∏—Ü–∏—é
   - –°–Ω–æ–≤–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—É—Å—Ç—É—é –∫–ª–µ—Ç–∫—É
   - –í—ã–∑—ã–≤–∞–µ—Ç `pawn.AvailableEnPassent(enemyPawn)` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

3. **`Pawn.AvailableKills()` —Å –ø–µ—Ä–µ–≥—Ä—É–∑–∫–æ–π** (Pawn.cs:103-132)
   - –ï—â–µ –æ–¥–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ en passant –≤ –º–µ—Ç–æ–¥–µ —Ñ–∏–≥—É—Ä—ã
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `AvailableEnPassent()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

4. **`Pawn.AvailableEnPassent()`** (Pawn.cs:135-143)
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏—è en passant (–ø–æ–∑–∏—Ü–∏–∏, —Ñ–ª–∞–≥–∏)

**–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫**:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ `piece == null || piece.IsDead`**:
   - `GetValidMoves()` (Game.cs:356)
   - `IsValidMove()` (MoveValidator.cs:25)
   - `ExecuteMove()` (MoveExecutor.cs:25)

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ `piece.Color != CurrentPlayerColor`**:
   - `GetValidMoves()` (Game.cs:361)
   - `IsValidMove()` (Game.cs:430)

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü –¥–æ—Å–∫–∏**:
   - `TryEnPassant()` (Game.cs:287-290)
   - `IsValidMove()` (MoveValidator.cs:29-30)

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç–æ–π –∫–ª–µ—Ç–∫–∏**:
   - `TryEnPassant()` (Game.cs:292-295)
   - `GetValidMoves()` –¥–ª—è en passant (Game.cs:403)

5. **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ `gameFieldString`**:
   - `GetValidMoves()` –≤—ã–∑—ã–≤–∞–µ—Ç `GetGameField(Pieces)`
   - `IsValidMove()` –≤—ã–∑—ã–≤–∞–µ—Ç `GetGameField(Pieces)`
   - `IsCheck()` –≤—ã–∑—ã–≤–∞–µ—Ç `GetGameField(Pieces)`
   - `IsCheckmate()` –≤—ã–∑—ã–≤–∞–µ—Ç `GetGameField(Pieces)`
   - –ö–∞–∂–¥—ã–π —Ä–∞–∑ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ `string[8,8]`

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**:

- üî¥ **MoveValidator –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—à–µ–∫** –≤ `GetValidMoves()` (—Å—Ç—Ä–æ–∫–∞ 413 –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞)
- üî¥ **–õ–æ–≥–∏–∫–∞ En Passant —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–∞** –º–µ–∂–¥—É Game, Pawn, MoveExecutor
- üî¥ **–ù–µ—Ç –µ–¥–∏–Ω–æ–≥–æ –º–µ—Å—Ç–∞** –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
- ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è `gameFieldString` –∏ –ø–µ—Ä–µ–±–æ—Ä—ã —Ñ–∏–≥—É—Ä

**–†–µ—à–µ–Ω–∏–µ: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏–∫–∏**

1. **–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤**
   ```csharp
   public interface IMoveCalculator
   {
       List<Position> GetAllPossibleMoves(IPiece piece, IGameState state);
       List<Position> GetEnPassantMoves(Pawn pawn, IGameState state);
   }
   ```

2. **–í—ã–Ω–µ—Å—Ç–∏ En Passant –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å**
   ```csharp
   public interface IEnPassantService
   {
       bool IsEnPassantAvailable(Pawn pawn, Pawn enemyPawn, IGameState state);
       Position GetEnPassantDestination(Pawn pawn, Pawn enemyPawn);
       List<Position> GetEnPassantMoves(Pawn pawn, IGameState state);
   }
   ```

3. **–ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**
   - –í—ã—á–∏—Å–ª—è—Ç—å `gameFieldString` –æ–¥–∏–Ω —Ä–∞–∑
   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∏–≥—É—Ä—ã
   - –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à –ø–æ—Å–ª–µ —Ö–æ–¥–∞

4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MoveValidator –≤–µ–∑–¥–µ**
   - –£–±—Ä–∞—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `FilterValidMoves()` –¥–ª—è –≤—Å–µ—Ö —Ñ–∏–≥—É—Ä, –≤–∫–ª—é—á–∞—è –ø–µ—à–∫–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –ª–æ–≥–∏–∫–∏
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ –∏–∑–º–µ–Ω—è—Ç—å

### 9. ‚ÑπÔ∏è **IView - —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–Ω–µ –ø—Ä–æ–±–ª–µ–º–∞)**

**–ê–Ω–∞–ª–∏–∑**: 
- `IView` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏ –∫–∞–∫ –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ `Console.WriteLine`
- –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ —É–±—Ä–∞—Ç—å - –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
- –ù–µ –Ω—É–∂–Ω–æ –Ω–∞–≤—è–∑—ã–≤–∞—Ç—å WPF

---

## üìê –ü–æ–¥—Ä–æ–±–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ ChessLib

### –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

```mermaid
classDiagram
    direction TB
    
    class Game {
        <<Domain Root>>
        -MoveValidator moveValidator
        -MoveExecutor moveExecutor
        +GameField GameField ‚ö†Ô∏è
        +int CurrentPlayer
        +List~IPiece~ Pieces ‚ö†Ô∏è
        +List~Player~ Players ‚ö†Ô∏è
        +bool IsGameOver
        +List~MoveNotation~ MoveHistory
        +MakeMove(Position, Position) MoveResult
        +GetValidMoves(Position) List~Position~ ‚ö°
        +GetState() GameState ‚ö°
        +GetFen() string
        +GetMoveHistory() string
        -UpdateGameField() void ‚ö°
        -GetGameField(List~IPiece~) string[,] ‚ö°
    }
    
    class GameField {
        <<Service>>
        -Cell[,] Field
        +Update(List~IPiece~, string[,], PieceColor) void ‚ö°
        +IsCellFree(Position) bool
        +GetAtackStatus(List~IPiece~, Position, string[,]) bool ‚ö°
    }
    
    class MoveValidator {
        <<Service>>
        -GameField gameField
        +IsValidMove(List~IPiece~, IPiece, Position, string[,]) bool ‚ö°
        +CanCastle(...) bool ‚ö°
        +FilterValidMoves(...) List~Position~ ‚ö°
    }
    
    class MoveExecutor {
        <<Service>>
        -GameField gameField
        +ExecuteMove(...) MoveResult
        +ExecuteCastling(...) MoveResult
        +ExecuteEnPassant(...) MoveResult
        +RemoveDeadPieces(List~IPiece~) void
    }
    
    class GameState {
        <<DTO>>
        +PieceColor CurrentPlayerColor
        +bool IsCheck
        +bool IsCheckmate
        +bool IsGameOver
        +string[,] BoardRepresentation ‚ö°
        +List~IPiece~ Pieces
    }
    
    class IPiece {
        <<interface>>
        +bool IsDead
        +PieceColor Color
        +Position Position
        +AvailableMoves(string[,]) List~Position~ ‚ö°
        +AvailableKills(string[,]) List~Position~ ‚ö°
    }
    
    class PieceBase {
        <<abstract>>
        #PieceColor Color
        #Position Position
        #bool IsDead
    }
    
    class Pawn {
        +bool EnPassantAvailable
        +Position StartPos
    }
    
    class King {
        +bool IsMoved
    }
    
    class Rook {
        +bool IsMoved
    }
    
    Game --> MoveValidator : uses
    Game --> MoveExecutor : uses
    Game --> GameField : uses
    Game --> IPiece : contains
    Game --> GameState : creates
    MoveValidator --> GameField : uses
    MoveExecutor --> GameField : uses
    IPiece <|.. PieceBase
    PieceBase <|-- Pawn
    PieceBase <|-- King
    PieceBase <|-- Rook
    
    %% Styling
    style Game fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#ffffff
    style GameField fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px,color:#ffffff
    style MoveValidator fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px,color:#ffffff
    style GameState fill:#f59f00,stroke:#d97706,stroke-width:2px,color:#ffffff
```

### –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```mermaid
sequenceDiagram
    autonumber
    participant WPF
    participant Game
    participant GetValidMoves
    participant GetGameField
    participant Piece
    participant GameField
    participant UpdateGameField
    
    Note over WPF,UpdateGameField: ‚ö° –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞—Å–∫–∞–¥–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏ –ø–µ—Ä–µ—Å—á–µ—Ç—ã
    
    activate WPF
    WPF->>+Game: GetValidMoves(position)
    activate Game
    Game->>+GetGameField: GetGameField(Pieces)
    activate GetGameField
    GetGameField->>GetGameField: –°–æ–∑–¥–∞–µ—Ç string[8,8]
    GetGameField->>GetGameField: –ü–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Ñ–∏–≥—É—Ä—ã
    GetGameField-->>-Game: string[,]
    deactivate GetGameField
    
    Game->>+Piece: AvailableMoves(gameFieldString)
    activate Piece
    Piece->>Piece: –ü–µ—Ä–µ—Å—á–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Ö–æ–¥–æ–≤
    Piece-->>-Game: List~Position~
    deactivate Piece
    
    Game->>+GameField: UpdateGameField()
    activate GameField
    GameField->>GameField: –û—á–∏—â–∞–µ—Ç –≤—Å–µ –∫–ª–µ—Ç–∫–∏
    GameField->>GameField: –î–ª—è –∫–∞–∂–¥–æ–π —Ñ–∏–≥—É—Ä—ã:<br/>GetAtackStatus()
    GameField->>GameField: –ü–µ—Ä–µ—Å—á–µ—Ç –∞—Ç–∞–∫
    deactivate GameField
    Game-->>-WPF: List~Position~
    deactivate Game
    deactivate WPF
    
    Note over WPF,UpdateGameField: –ü—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ - –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å—á–µ—Ç!
```

### –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

```mermaid
classDiagram
    direction TB
    
    class IGameEngine {
        <<interface>>
        +MakeMove(Position, Position) MoveResult
        +GetValidMoves(Position) List~Position~
        +GetState() IGameState
        +GetFen() string
        +GetMoveHistory() string
        +StartNewGame() void
        ‚úÖ –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–ª—è View
    }
    
    class GameEngine {
        <<Domain Root>>
        -IBoardState boardState
        -IMoveCalculator moveCalculator
        -IMoveValidator moveValidator
        -IMoveExecutor moveExecutor
        -IGameStateCache stateCache
        +MakeMove(Position, Position) MoveResult
        +GetValidMoves(Position) List~Position~
        +GetState() IGameState
        ‚úÖ –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
        ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Strategy Pattern
    }
    
    class IMoveCalculator {
        <<interface>>
        +GetValidMoves(IPiece, IGameState) List~Position~
        ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ö–æ–¥–æ–≤
    }
    
    class MoveCalculator {
        -IMoveStrategyRegistry strategyRegistry
        -ISpecialMoveStrategy[] specialStrategies
        -IMoveValidator moveValidator
        +GetValidMoves(IPiece, IGameState) List~Position~
        ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
    }
    
    class IMoveStrategy {
        <<interface>>
        +PieceType PieceType
        +GetPossibleMoves(IPiece, IBoardQuery) List~Position~
        +GetPossibleCaptures(IPiece, IBoardQuery) List~Position~
        ‚úÖ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–≤–∏–∂–µ–Ω–∏—è —Ñ–∏–≥—É—Ä—ã
    }
    
    class IMoveStrategyRegistry {
        <<interface>>
        +GetStrategy(PieceType) IMoveStrategy
        ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
    }
    
    class PawnMoveStrategy {
        +GetPossibleMoves(IPiece, IBoardQuery) List~Position~
        +GetPossibleCaptures(IPiece, IBoardQuery) List~Position~
        ‚úÖ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –ø–µ—à–∫–∏
    }
    
    class ISpecialMoveStrategy {
        <<interface>>
        +GetSpecialMoves(IPiece, IGameState) List~Position~
        ‚úÖ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ö–æ–¥—ã (En Passant, —Ä–æ–∫–∏—Ä–æ–≤–∫–∞)
    }
    
    class EnPassantStrategy {
        +GetSpecialMoves(IPiece, IGameState) List~Position~
        ‚úÖ –°—Ç—Ä–∞—Ç–µ–≥–∏—è En Passant
    }
    
    class CastlingStrategy {
        +GetSpecialMoves(IPiece, IGameState) List~Position~
        ‚úÖ –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–æ–∫–∏—Ä–æ–≤–∫–∏
    }
    
    class IBoardQuery {
        <<interface>>
        +GetPieceAt(Position) IPieceInfo
        +IsCellFree(Position) bool
        +IsCellAttacked(Position, PieceColor) bool
        ‚úÖ –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å–∫–∏ –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
    }
    
    class IBoardState {
        <<interface>>
        +GetPieceAt(Position) IPieceInfo
        +IsCellFree(Position) bool
        +GetAttackedCells(PieceColor) IEnumerable~Position~
        ‚úÖ –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–æ—Å–∫–∏
    }
    
    class BoardState {
        <<Service>>
        -IBoardRepresentation representation
        +GetPieceAt(Position) IPieceInfo
        +IsCellFree(Position) bool
        ‚úÖ –ú–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ bitboards
    }
    
    class IBoardRepresentation {
        <<interface>>
        +GetPieceAt(Position) IPieceInfo
        +UpdateAfterMove(Move) void
        ‚úÖ –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
    }
    
    class ArrayBoardRepresentation {
        <<Implementation>>
        -IPieceInfo[,] board
        ‚úÖ –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    }
    
    class BitboardRepresentation {
        <<Future Implementation>>
        -ulong[] bitboards
        ‚úÖ –ë—É–¥—É—â–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
    }
    
    class IGameState {
        <<interface>>
        +PieceColor CurrentPlayerColor
        +bool IsCheck
        +bool IsCheckmate
        +bool IsGameOver
        +IReadOnlyList~IPieceInfo~ Pieces
        ‚úÖ –ù–µ–∏–∑–º–µ–Ω—è–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    }
    
    class GameState {
        <<DTO>>
        +PieceColor CurrentPlayerColor
        +bool IsCheck
        +bool IsCheckmate
        +bool IsGameOver
        +IReadOnlyList~IPieceInfo~ Pieces
        ‚úÖ Immutable DTO
    }
    
    class IGameStateCache {
        <<interface>>
        +IGameState GetCurrentState()
        +void Invalidate()
        +void UpdateAfterMove(Move)
        ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    }
    
    IGameEngine <|.. GameEngine
    GameEngine --> IBoardState : uses
    GameEngine --> IMoveCalculator : uses
    GameEngine --> IGameStateCache : uses
    GameEngine --> IGameState : returns
    IBoardState <|.. BoardState
    BoardState --> IBoardRepresentation : uses
    IBoardRepresentation <|.. ArrayBoardRepresentation
    IBoardRepresentation <|.. BitboardRepresentation : future
    IMoveCalculator <|.. MoveCalculator
    MoveCalculator --> IMoveStrategyRegistry : uses
    MoveCalculator --> ISpecialMoveStrategy : uses
    MoveCalculator --> IMoveValidator : uses
    IMoveStrategyRegistry --> IMoveStrategy : provides
    IMoveStrategy <|.. PawnMoveStrategy
    ISpecialMoveStrategy <|.. EnPassantStrategy
    ISpecialMoveStrategy <|.. CastlingStrategy
    IMoveStrategy --> IBoardQuery : uses
    IGameState <|.. GameState
    GameEngine --> IGameStateCache : uses
    
    %% Styling
    style IGameEngine fill:#2f9e44,stroke:#1e7e34,stroke-width:3px,color:#ffffff
    style GameEngine fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IBoardState fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IBoardRepresentation fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IGameState fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IGameStateCache fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style BitboardRepresentation fill:#6c757d,stroke:#495057,stroke-width:2px,color:#ffffff
```

### –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)

```mermaid
sequenceDiagram
    autonumber
    participant WPF
    participant IGameEngine
    participant GameEngine
    participant StateCache
    participant BoardState
    
    rect rgb(240, 250, 240)
        Note over WPF,BoardState: ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
        
        activate WPF
        WPF->>+IGameEngine: GetValidMoves(position)
        activate IGameEngine
        IGameEngine->>+GameEngine: GetValidMoves(position)
        activate GameEngine
        GameEngine->>+StateCache: GetCurrentState()
        StateCache-->>-GameEngine: IGameState (cached)
        deactivate StateCache
        GameEngine->>+BoardState: GetValidMoves(position, state)
        BoardState-->>-GameEngine: List~Position~
        deactivate BoardState
        GameEngine-->>-IGameEngine: List~Position~
        deactivate GameEngine
        IGameEngine-->>-WPF: List~Position~
        deactivate IGameEngine
        deactivate WPF
        
        Note right of StateCache: –ö—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ<br/>–ø–æ—Å–ª–µ —Ö–æ–¥–∞
    end
```

---

## üèóÔ∏è –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (WPF ‚Üî Library)

```mermaid
graph TB
    subgraph WPF["üñ•Ô∏è WPF Application"]
        direction TB
        MW["üì± MainWindow"]
        MV["üéõÔ∏è MainViewModel"]
        GV["üéÆ GameViewModel<br/>‚ö†Ô∏è –°–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É"]
        BV["üìä BoardViewModel"]
        
        subgraph WPF_Services["‚öôÔ∏è WPF Services"]
            CGS["üîÑ ChessGameService<br/>‚ö†Ô∏è –õ–∏—à–Ω–∏–π —Å–ª–æ–π"]
        end
        
        BSS["üì¶ BoardStateSnapshot<br/>‚ö†Ô∏è –î—É–±–ª–∏—Ä—É–µ—Ç GameState"]
    end
    
    subgraph ChessLib["‚ôüÔ∏è ChessLib Domain"]
        direction TB
        G["üéØ Game<br/>‚ö†Ô∏è –ü—É–±–ª–∏—á–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞<br/>‚ö° –ö–∞—Å–∫–∞–¥–Ω—ã–µ –≤—ã–∑–æ–≤—ã"]
        GS["üìã GameState"]
        GF["üó∫Ô∏è GameField<br/>‚ö° –ü–µ—Ä–µ—Å—á–µ—Ç—ã"]
        
        subgraph Pieces["‚ôüÔ∏è Pieces"]
            IP["üî∑ IPiece"]
        end
    end
    
    %% Connections
    MW --> MV
    MV --> GV
    GV --> BV
    GV --> CGS
    CGS -->|"üî¥ –ø—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å"| G
    CGS -.->|"—Å–æ–∑–¥–∞–µ—Ç"| BSS
    G --> GS
    G --> GF
    G --> IP
    
    %% Styling
    style GV fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#ffffff
    style CGS fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#ffffff
    style BSS fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#ffffff
    style G fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px,color:#ffffff
    style GF fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px,color:#ffffff
```

---

## üìê –ü–æ–ª–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (—É—Ä–æ–≤–µ–Ω—å –∫–ª–∞—Å—Å–æ–≤)

### üî¥ –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (WPF ‚Üî ChessLib)

```mermaid
classDiagram
    %% WPF Layer
    class MainWindow {
        +MainViewModel ViewModel
    }
    
    class MainViewModel {
        +GameViewModel Game
        +BoardViewModel Board
        +TimerViewModel Timer
        +CapturedPiecesViewModel CapturedPieces
        +GameStorageViewModel GameStorage
        +MoveHistoryViewModel MoveHistory
        +SettingsViewModel Settings
    }
    
    class GameViewModel {
        -ChessGameService gameService
        -BoardViewModel board
        +HandleCellClick(Position)
        +MakeMove(Position, Position)
        +GetValidMoves(Position)
        +UpdateViewFromGameState()
    }
    
    class BoardViewModel {
        -CellViewModel[,] cells
        +UpdateFromSnapshot(BoardStateSnapshot)
    }
    
    class CellViewModel {
        +Position Position
        +PieceInfo Piece
        +CellUIState State
    }
    
    class ChessGameService {
        -Game _game
        +Game CurrentGame
        +BoardStateSnapshot GetBoardState()
        +List~Position~ GetValidMoves(Position)
        +MoveResult MakeMove(Position, Position)
    }
    
    class BoardStateSnapshot {
        +PieceInfo[,] Cells
        +PieceColor CurrentPlayerColor
        +bool IsCheck
        +bool IsCheckmate
    }
    
    %% ChessLib Layer
    class Game {
        +List~IPiece~ Pieces
        +GameField GameField
        +List~Player~ Players
        +MoveResult MakeMove(Position, Position)
        +List~Position~ GetValidMoves(Position)
        +GameState GetState()
        +string GetFen()
    }
    
    class GameState {
        +List~IPiece~ Pieces
        +PieceColor CurrentPlayerColor
        +bool IsCheck
        +bool IsCheckmate
    }
    
    class GameField {
        +Update(List~IPiece~, string[,], PieceColor)
        +GetAtackStatus(List~IPiece~, Position, string[,])
    }
    
    class IPiece {
        <<interface>>
        +Position Position
        +PieceColor Color
        +bool IsDead
        +List~Position~ AvailableMoves(string[,])
        +List~Position~ AvailableKills(string[,])
    }
    
    class MoveValidator {
        +bool IsValidMove(List~IPiece~, IPiece, Position, string[,])
        +List~Position~ FilterValidMoves(List~IPiece~, IPiece, List~Position~, string[,])
    }
    
    class MoveExecutor {
        +MoveResult ExecuteMove(List~IPiece~, IPiece, Position, string[,])
    }
    
    %% Connections
    MainWindow --> MainViewModel
    MainViewModel --> GameViewModel
    MainViewModel --> BoardViewModel
    GameViewModel --> ChessGameService
    GameViewModel --> BoardViewModel
    BoardViewModel --> CellViewModel
    ChessGameService --> Game : üî¥ –ø—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
    ChessGameService --> BoardStateSnapshot : —Å–æ–∑–¥–∞–µ—Ç
    Game --> GameState
    Game --> GameField
    Game --> IPiece
    Game --> MoveValidator
    Game --> MoveExecutor
    BoardStateSnapshot ..> GameState : –¥—É–±–ª–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ
    
    %% Styling
    style GameViewModel fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px,color:#ffffff
    style ChessGameService fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px,color:#ffffff
    style BoardStateSnapshot fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px,color:#ffffff
    style Game fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px,color:#ffffff
    style GameField fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px,color:#ffffff
    style IPiece fill:#ff6b6b,stroke:#c92a2a,stroke-width:2px,color:#ffffff
```

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (WPF ‚Üî ChessLib)

```mermaid
classDiagram
    %% WPF Layer
    class MainWindow {
        +MainViewModel ViewModel
    }
    
    class MainViewModel {
        +GameViewModel Game
        +BoardViewModel Board
        +TimerViewModel Timer
        +CapturedPiecesViewModel CapturedPieces
        +GameStorageViewModel GameStorage
        +MoveHistoryViewModel MoveHistory
        +SettingsViewModel Settings
    }
    
    class GameViewModel {
        -IGameService gameService
        -BoardViewModel board
        +HandleCellClick(Position)
        +UpdateViewFromGameState()
    }
    
    class BoardViewModel {
        -CellViewModel[,] cells
        +UpdateFromState(IGameState)
    }
    
    class CellViewModel {
        +Position Position
        +IPieceInfo Piece
        +CellUIState State
    }
    
    %% Application Layer
    class IGameService {
        <<interface>>
        +MoveResult MakeMove(Position, Position)
        +IReadOnlyList~Position~ GetValidMoves(Position)
        +IGameState GetState()
        +void StartNewGame()
    }
    
    class GameService {
        -IGameEngine gameEngine
        +MoveResult MakeMove(Position, Position)
        +IReadOnlyList~Position~ GetValidMoves(Position)
        +IGameState GetState()
    }
    
    %% ChessLib Domain Layer
    class IGameEngine {
        <<interface>>
        +MoveResult MakeMove(Position, Position)
        +IReadOnlyList~Position~ GetValidMoves(Position)
        +IGameState GetState()
        +void StartNewGame()
    }
    
    class GameEngine {
        -Game game
        -IGameStateCache cache
        -IMoveCalculator moveCalculator
        +MoveResult MakeMove(Position, Position)
        +IReadOnlyList~Position~ GetValidMoves(Position)
        +IGameState GetState()
    }
    
    class IGameState {
        <<interface>>
        +PieceColor CurrentPlayerColor
        +bool IsCheck
        +bool IsCheckmate
        +IReadOnlyList~IPieceInfo~ Pieces
    }
    
    class GameState {
        +PieceColor CurrentPlayerColor
        +bool IsCheck
        +bool IsCheckmate
        +IReadOnlyList~IPieceInfo~ Pieces
    }
    
    class IGameStateCache {
        <<interface>>
        +IGameState GetState()
        +void Invalidate()
    }
    
    class GameStateCache {
        -IGameState cachedState
        -Dictionary~Position, List~Position~~ cachedMoves
        +IGameState GetState()
        +void Invalidate()
    }
    
    class IMoveCalculator {
        <<interface>>
        +List~Position~ GetValidMoves(IPiece, IGameState)
    }
    
    class MoveCalculator {
        -IMoveStrategyRegistry strategyRegistry
        -ISpecialMoveStrategy[] specialStrategies
        -IMoveValidator moveValidator
        +List~Position~ GetValidMoves(IPiece, IGameState)
    }
    
    class IMoveStrategy {
        <<interface>>
        +PieceType PieceType
        +List~Position~ GetPossibleMoves(IPiece, IBoardQuery)
        +List~Position~ GetPossibleCaptures(IPiece, IBoardQuery)
    }
    
    class IMoveStrategyRegistry {
        <<interface>>
        +IMoveStrategy GetStrategy(PieceType)
    }
    
    class MoveStrategyRegistry {
        -Dictionary~PieceType, IMoveStrategy~ strategies
        +IMoveStrategy GetStrategy(PieceType)
    }
    
    class PawnMoveStrategy {
        +List~Position~ GetPossibleMoves(IPiece, IBoardQuery)
        +List~Position~ GetPossibleCaptures(IPiece, IBoardQuery)
    }
    
    class ISpecialMoveStrategy {
        <<interface>>
        +List~Position~ GetSpecialMoves(IPiece, IGameState)
    }
    
    class EnPassantStrategy {
        +List~Position~ GetSpecialMoves(IPiece, IGameState)
    }
    
    class IBoardQuery {
        <<interface>>
        +IPieceInfo GetPieceAt(Position)
        +bool IsCellFree(Position)
        +bool IsCellAttacked(Position, PieceColor)
    }
    
    class BoardQuery {
        -IGameState state
        +IPieceInfo GetPieceAt(Position)
        +bool IsCellFree(Position)
        +bool IsCellAttacked(Position, PieceColor)
    }
    
    class IPieceInfo {
        <<interface>>
        +PieceType Type
        +PieceColor Color
        +Position Position
    }
    
    class IPiece {
        <<interface>>
        +PieceType Type
        +PieceColor Color
        +Position Position
        +bool IsDead
    }
    
    class IMoveValidator {
        <<interface>>
        +bool IsValidMove(IPiece, Position, IGameState)
        +List~Position~ FilterValidMoves(IPiece, List~Position~, IGameState)
    }
    
    class MoveValidator {
        +bool IsValidMove(IPiece, Position, IGameState)
        +List~Position~ FilterValidMoves(IPiece, List~Position~, IGameState)
    }
    
    %% Connections
    MainWindow --> MainViewModel
    MainViewModel --> GameViewModel
    MainViewModel --> BoardViewModel
    GameViewModel --> IGameService : ‚úÖ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    GameViewModel --> BoardViewModel
    BoardViewModel --> CellViewModel
    BoardViewModel --> IGameState : ‚úÖ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–∞–ø—Ä—è–º—É—é
    IGameService <|.. GameService : implements
    GameService --> IGameEngine : ‚úÖ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    IGameEngine <|.. GameEngine : implements
    GameEngine --> IGameStateCache
    GameEngine --> IMoveCalculator
    IGameStateCache <|.. GameStateCache : implements
    IGameState <|.. GameState : implements
    IMoveCalculator <|.. MoveCalculator : implements
    MoveCalculator --> IMoveStrategyRegistry
    MoveCalculator --> ISpecialMoveStrategy
    MoveCalculator --> IMoveValidator
    IMoveStrategyRegistry <|.. MoveStrategyRegistry : implements
    IMoveStrategy <|.. PawnMoveStrategy : implements
    ISpecialMoveStrategy <|.. EnPassantStrategy : implements
    IMoveStrategy --> IBoardQuery : –∏—Å–ø–æ–ª—å–∑—É–µ—Ç
    IBoardQuery <|.. BoardQuery : implements
    BoardQuery --> IGameState
    IMoveValidator <|.. MoveValidator : implements
    
    %% Styling
    style GameViewModel fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IGameService fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style GameService fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IGameEngine fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style GameEngine fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IGameState fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IGameStateCache fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IMoveCalculator fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IMoveStrategy fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IBoardQuery fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IPieceInfo fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
```

### üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π

**–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ø—Ä–æ–±–ª–µ–º—ã)**:
- üî¥ `GameViewModel` ‚Üí `ChessGameService` ‚Üí `Game` (–ø—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å)
- üî¥ `ChessGameService` —Å–æ–∑–¥–∞–µ—Ç `BoardStateSnapshot` (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
- üî¥ `GameViewModel` —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (`MakeMove`, `GetValidMoves`)
- ‚ö° –ö–∞—Å–∫–∞–¥–Ω—ã–µ –≤—ã–∑–æ–≤—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- üî¥ –§–∏–≥—É—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å `string[,]` –Ω–∞–ø—Ä—è–º—É—é

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Ä–µ—à–µ–Ω–∏—è)**:
- ‚úÖ `GameViewModel` ‚Üí `IGameService` ‚Üí `IGameEngine` (—á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)
- ‚úÖ `BoardViewModel` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IGameState` –Ω–∞–ø—Ä—è–º—É—é (–Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)
- ‚úÖ `GameViewModel` —Ç–æ–ª—å–∫–æ UI –ª–æ–≥–∏–∫–∞, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `IGameStateCache` (–Ω–µ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤)
- ‚úÖ –§–∏–≥—É—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ `IBoardQuery` –∏ `IMoveStrategy` (–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è)

---

## ‚ú® –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

> **üìù –ü–æ—è—Å–Ω–µ–Ω–∏–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π –≤ –¥–∏–∞–≥—Ä–∞–º–º–∞—Ö:**
> - **ISMS** = `ISpecialMoveStrategy` (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ö–æ–¥–æ–≤: En Passant, —Ä–æ–∫–∏—Ä–æ–≤–∫–∞)
> - **EPS** = `EnPassantStrategy` (—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–∑—è—Ç–∏—è –Ω–∞ –ø—Ä–æ—Ö–æ–¥–µ)
> - **CS** = `CastlingStrategy` (—Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–æ–∫–∏—Ä–æ–≤–∫–∏)
> - **IMS** = `IMoveStrategy` (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è —Ñ–∏–≥—É—Ä)
> - **MSR** = `MoveStrategyRegistry` (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π)
> - **PMS** = `PawnMoveStrategy`, **KMS** = `KingMoveStrategy`, **QMS** = `QueenMoveStrategy` (—Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è —Ñ–∏–≥—É—Ä)

```mermaid
graph TB
    subgraph WPF["üñ•Ô∏è WPF Application"]
        direction TB
        MW["üì± MainWindow"]
        MV["üéõÔ∏è MainViewModel"]
        GV["üéÆ GameViewModel<br/>‚úÖ –¢–æ–ª—å–∫–æ UI –ª–æ–≥–∏–∫–∞"]
        BV["üìä BoardViewModel"]
    end
    
    subgraph Application["üîå Application Layer"]
        direction TB
        IGS["üìê IGameService<br/>‚úÖ –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è<br/>&lt;&lt;interface&gt;&gt;"]
        GS_Impl["‚öôÔ∏è GameService<br/>‚úÖ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è"]
    end
    
    subgraph ChessLib["‚ôüÔ∏è ChessLib Domain"]
        direction TB
        IGE["üéØ IGameEngine<br/>‚úÖ –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è<br/>&lt;&lt;interface&gt;&gt;"]
        GE["‚öôÔ∏è GameEngine<br/>‚úÖ –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è<br/>—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è"]
        IGS_State["üìã IGameState<br/>‚úÖ –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è"]
        Cache["üíæ StateCache<br/>‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ"]
        
        subgraph Board["üó∫Ô∏è Board Abstraction"]
            IBS["üìê IBoardState"]
            IBR["üìê IBoardRepresentation"]
            ABR["‚öôÔ∏è ArrayBoardRep<br/>–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è"]
            BBR["‚öôÔ∏è BitboardRep<br/>üîÆ –ë—É–¥—É—â–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è"]
        end
    end
    
    %% Connections
    MW --> MV
    MV --> GV
    GV --> BV
    GV --> IGS
    IGS -.->|"implements"| GS_Impl
    GS_Impl --> IGE
    IGE -.->|"implements"| GE
    GE --> IBS
    GE --> Cache
    GE --> IGS_State
    GE --> IMS
    IBS --> IBR
    IBR -.->|"implements"| ABR
    IBR -.->|"future"| BBR
    IMS -.->|"implements"| PMS
    IMS -.->|"implements"| KMS
    IMS -.->|"implements"| QMS
    MSR --> IMS
    ISMS -.->|"implements"| EPS
    ISMS -.->|"implements"| CS
    
    %% –ü–æ—è—Å–Ω–µ–Ω–∏–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–π:
    %% ISMS = ISpecialMoveStrategy (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ö–æ–¥–æ–≤: En Passant, —Ä–æ–∫–∏—Ä–æ–≤–∫–∞)
    %% EPS = EnPassantStrategy (—Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–∑—è—Ç–∏—è –Ω–∞ –ø—Ä–æ—Ö–æ–¥–µ)
    %% CS = CastlingStrategy (—Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ä–æ–∫–∏—Ä–æ–≤–∫–∏)
    
    %% Styling
    style GV fill:#2f9e44,stroke:#1e7e34,stroke-width:3px,color:#ffffff
    style IGS fill:#2f9e44,stroke:#1e7e34,stroke-width:3px,color:#ffffff
    style GS_Impl fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IGE fill:#2f9e44,stroke:#1e7e34,stroke-width:3px,color:#ffffff
    style GE fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IGS_State fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style Cache fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style BBR fill:#6c757d,stroke:#495057,stroke-width:2px,color:#ffffff
```

---

## üìã –ü–æ—ç—Ç–∞–ø–Ω—ã–π –ø–ª–∞–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –ù–∞—á–∏–Ω–∞–µ–º —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏! –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –µ—ë –≤ –±—É–¥—É—â–µ–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ WPF.

### üéØ –û–±—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

1. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç #1)
   - –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä
   - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –ú–µ—Ç–æ–¥—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä—ã (–¥–ª—è –±—ç–∫–µ–Ω–¥–∞)
   - –ê–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

2. **–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç #2)
   - –°–æ–∑–¥–∞–Ω–∏–µ `IGameService` –≤ Application —Å–ª–æ–µ
   - –°–æ–∑–¥–∞–Ω–∏–µ `IGameEngine` –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ
   - –£–±—Ä–∞—Ç—å –ø—Ä—è–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

3. **–£–ø—Ä–æ—â–µ–Ω–∏–µ WPF** (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç #3)
   - –£–±—Ä–∞—Ç—å `BoardStateSnapshot`
   - –£–±—Ä–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ PGN –∏–∑ WPF (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É)
   - –í—ã–Ω–µ—Å—Ç–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏–∑ ViewModels

---

### üìç –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

**–¶–µ–ª—å**: –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å—Ä–µ–¥—É –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

**–®–∞–≥–∏**:

1. **–°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞**
   ```bash
   git checkout -b refactoring/library-first
   ```

2. **–ù–∞–ø–∏—Å–∞—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã**
   - [ ] –ü–æ–∫—Ä—ã—Ç—å `Game` unit-—Ç–µ—Å—Ç–∞–º–∏
   - [ ] –ü–æ–∫—Ä—ã—Ç—å `GameField` unit-—Ç–µ—Å—Ç–∞–º–∏
   - [ ] –î–æ–±–∞–≤–∏—Ç—å performance —Ç–µ—Å—Ç—ã –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
   - [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

3. **–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é**
   - [ ] –°–æ–∑–¥–∞—Ç—å —Ç–µ–≥ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏
   - [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –≤–µ—Ç–∫–∞ –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
- ‚úÖ –ï—Å—Ç—å —Ç–æ—á–∫–∞ –æ—Ç–∫–∞—Ç–∞

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: 2-4 —á–∞—Å–∞

---

### üìç –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ

**–¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

**–®–∞–≥–∏**:

1. **–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IGameEngine**
   ```csharp
   // ChessLib/IGameEngine.cs
   public interface IGameEngine
   {
       MoveResult MakeMove(Position from, Position to);
       IReadOnlyList<Position> GetValidMoves(Position position);
       IGameState GetState();
       string GetFen();
       string GetMoveHistory();
       void StartNewGame();
       void EndGameByTime(PieceColor losingColor);
   }
   ```

2. **–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IGameState**
   ```csharp
   // ChessLib/IGameState.cs
   public interface IGameState
   {
       PieceColor CurrentPlayerColor { get; }
       bool IsCheck { get; }
       bool IsCheckmate { get; }
       bool IsGameOver { get; }
       IReadOnlyList<IPieceInfo> Pieces { get; }
   }
   ```

3. **–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IBoardState**
   ```csharp
   // ChessLib/IBoardState.cs
   public interface IBoardState
   {
       IPieceInfo GetPieceAt(Position position);
       bool IsCellFree(Position position);
       IReadOnlyList<Position> GetAttackedCells(PieceColor color);
   }
   ```

4. **–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IPieceInfo**
   ```csharp
   // ChessLib/IPieceInfo.cs
   public interface IPieceInfo
   {
       PieceType Type { get; }
       PieceColor Color { get; }
       Position Position { get; }
   }
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ –í—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä
- ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≥–æ—Ç–æ–≤—ã –¥–ª—è –±—É–¥—É—â–∏—Ö –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: 2-3 —á–∞—Å–∞

**–†–∏—Å–∫–∏**: –ù–∏–∑–∫–∏–µ (—Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)

---

### üìç –≠—Ç–∞–ø 3: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Game ‚Üí GameEngine —Å CQRS + Strategy Pattern

**–¶–µ–ª—å**: –ò–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞—Ç—å Game, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å IGameEngine —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Strategy Pattern

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

**–®–∞–≥–∏**:

1. **–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IMoveStrategy –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏**
   - [ ] –°–æ–∑–¥–∞—Ç—å `IMoveStrategy` —Å –º–µ—Ç–æ–¥–∞–º–∏ `GetPossibleMoves()` –∏ `GetPossibleCaptures()`
   - [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–∏–≥—É—Ä—ã: `PawnMoveStrategy`, `KingMoveStrategy`, `QueenMoveStrategy`, `RookMoveStrategy`, `BishopMoveStrategy`, `KnightMoveStrategy`
   - [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∏–∑ `AvailableMoves()`/`AvailableKills()` –≤ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
   - [ ] –°–æ–∑–¥–∞—Ç—å `IMoveStrategyRegistry` –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π

2. **–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IBoardQuery**
   - [ ] –°–æ–∑–¥–∞—Ç—å `IBoardQuery` —Å –º–µ—Ç–æ–¥–∞–º–∏ `GetPieceAt()`, `IsCellFree()`, `IsCellAttacked()`
   - [ ] –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `IBoardQuery` –≤–º–µ—Å—Ç–æ `string[,]`

3. **–°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å GameEngine**
   - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `IGameEngine`
   - [ ] –°–¥–µ–ª–∞—Ç—å –≤—Å–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ–ª—è private
   - [ ] –£–±—Ä–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ `Pieces`, `GameField`, `Players`

4. **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
   - [ ] –°–æ–∑–¥–∞—Ç—å `IGameStateCache`
   - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ `GameState`
   - [ ] –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ö–æ–¥–∞

5. **–û–±–Ω–æ–≤–∏—Ç—å IPiece**
   - [ ] –£–±—Ä–∞—Ç—å –º–µ—Ç–æ–¥—ã `AvailableMoves()`/`AvailableKills()` –∏–∑ `IPiece`
   - [ ] –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–π—Å—Ç–≤–∞: `Type`, `Color`, `Position`, `IsDead`

6. **–û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã**
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `IGameEngine`
   - [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
   - [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ `IMoveStrategy` –∏ –≤—Å–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ `IMoveStrategyRegistry` —Å–æ–∑–¥–∞–Ω
- ‚úÖ `IBoardQuery` —Å–æ–∑–¥–∞–Ω
- ‚úÖ `GameEngine` –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –§–∏–≥—É—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: 8-10 —á–∞—Å–æ–≤

**–†–∏—Å–∫–∏**: –°—Ä–µ–¥–Ω–∏–µ (–Ω—É–∂–Ω–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–≥—É—Ä—ã –Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π —ç—Ç–∞–ø –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º (bitboards). Strategy Pattern –¥–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≥–∏–±–∫–æ—Å—Ç—å

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: 4-6 —á–∞—Å–æ–≤

**–†–∏—Å–∫–∏**: –°—Ä–µ–¥–Ω–∏–µ (–Ω—É–∂–Ω–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É)

---

### üìç –≠—Ç–∞–ø 4: –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è BoardState

**–¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å–∫–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü° –í—ã—Å–æ–∫–∏–π

**–®–∞–≥–∏**:

1. **–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IBoardRepresentation**
   ```csharp
   public interface IBoardRepresentation
   {
       IPieceInfo GetPieceAt(Position position);
       void SetPieceAt(Position position, IPieceInfo piece);
       void ClearCell(Position position);
       void UpdateAfterMove(Move move);
   }
   ```

2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ArrayBoardRepresentation**
   - [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –∏–∑ `GameField`
   - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `IPieceInfo` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ `IPiece`

3. **–û–±–Ω–æ–≤–∏—Ç—å GameEngine**
   - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `IBoardRepresentation` —á–µ—Ä–µ–∑ `IBoardState`
   - [ ] –£–±—Ä–∞—Ç—å –ø—Ä—è–º—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `GameField`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ `IBoardRepresentation` —Å–æ–∑–¥–∞–Ω
- ‚úÖ `ArrayBoardRepresentation` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ `GameEngine` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: 3-4 —á–∞—Å–∞

**–†–∏—Å–∫–∏**: –°—Ä–µ–¥–Ω–∏–µ (–Ω—É–∂–Ω–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–ª—è –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `BitboardRepresentation`

---

### üìç –≠—Ç–∞–ø 7: –°–æ–∑–¥–∞–Ω–∏–µ IGameService –≤ Application —Å–ª–æ–µ

**–¶–µ–ª—å**: –°–æ–∑–¥–∞—Ç—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—é –¥–ª—è WPF –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü° –í—ã—Å–æ–∫–∏–π

**–®–∞–≥–∏**:

1. **–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å IGameService**
   ```csharp
   // WPFChess/Services/IGameService.cs
   public interface IGameService
   {
       MoveResult MakeMove(Position from, Position to);
       IGameState GetState();
       IReadOnlyList<Position> GetValidMoves(Position position);
       string GetFen();
       string GetMoveHistory();
       void StartNewGame();
       void EndGameByTime(PieceColor losingColor);
   }
   ```

2. **–°–æ–∑–¥–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é GameService**
   - [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `IGameService`
   - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `IGameEngine` –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
   - [ ] –í–æ–∑–≤—Ä–∞—â–∞—Ç—å `IGameState` –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π)

3. **–ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã**
   - [ ] Unit-—Ç–µ—Å—Ç—ã –¥–ª—è `IGameService`
   - [ ] –ú–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `IGameService` —Å–æ–∑–¥–∞–Ω
- ‚úÖ –ö–ª–∞—Å—Å `GameService` —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –Ω–æ–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
- ‚úÖ `GameService` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `IGameState` –Ω–∞–ø—Ä—è–º—É—é

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: 2-3 —á–∞—Å–∞

**–†–∏—Å–∫–∏**: –ù–∏–∑–∫–∏–µ (–ø—Ä–æ—Å—Ç–∞—è –æ–±–µ—Ä—Ç–∫–∞)

---

### üìç –≠—Ç–∞–ø 8: –ú–∏–≥—Ä–∞—Ü–∏—è WPF –Ω–∞ IGameService

**–¶–µ–ª—å**: –ó–∞–º–µ–Ω–∏—Ç—å `ChessGameService` –Ω–∞ `IGameService`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü° –í—ã—Å–æ–∫–∏–π

**–®–∞–≥–∏**:

1. **–û–±–Ω–æ–≤–∏—Ç—å GameViewModel**
   - [ ] –ó–∞–º–µ–Ω–∏—Ç—å `ChessGameService` –Ω–∞ `IGameService`
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–æ–≤

2. **–û–±–Ω–æ–≤–∏—Ç—å BoardViewModel**
   - [ ] –£–±—Ä–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `BoardStateSnapshot`
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `UpdateFromGameState(IGameState state)`
   - [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `IGameState` –Ω–∞–ø—Ä—è–º—É—é

3. **–û–±–Ω–æ–≤–∏—Ç—å DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**
   - [ ] –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å `IGameService` ‚Üí `GameService`
   - [ ] –£–±—Ä–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é `ChessGameService`

4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**
   - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏
   - [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ `GameViewModel` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IGameService`
- ‚úÖ `BoardStateSnapshot` –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: 2-3 —á–∞—Å–∞

**–†–∏—Å–∫–∏**: –°—Ä–µ–¥–Ω–∏–µ (–Ω—É–∂–Ω–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)

---

### üìç –≠—Ç–∞–ø 9: –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–æ–¥–∞

**–¶–µ–ª—å**: –£–¥–∞–ª–∏—Ç—å `ChessGameService` –∏ `BoardStateSnapshot`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üü¢ –°—Ä–µ–¥–Ω–∏–π

**–®–∞–≥–∏**:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**
   - [ ] –ù–∞–π—Ç–∏ –≤—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `ChessGameService`
   - [ ] –ù–∞–π—Ç–∏ –≤—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `BoardStateSnapshot`
   - [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å

2. **–£–¥–∞–ª–∏—Ç—å –∫–ª–∞—Å—Å—ã**
   - [ ] –£–¥–∞–ª–∏—Ç—å `ChessGameService.cs`
   - [ ] –£–¥–∞–ª–∏—Ç—å `BoardStateSnapshot.cs`
   - [ ] –£–¥–∞–ª–∏—Ç—å `PieceInfo.cs` (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

3. **–û—á–∏—Å—Ç–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
   - [ ] –£–±—Ä–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–∑ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
   - [ ] –£–±—Ä–∞—Ç—å using –¥–∏—Ä–µ–∫—Ç–∏–≤—ã

4. **–§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
   - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –∫–æ–¥ —É–¥–∞–ª–µ–Ω
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: 1-2 —á–∞—Å–∞

**–†–∏—Å–∫–∏**: –ù–∏–∑–∫–∏–µ (–∫–æ–¥ —É–∂–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

---

### üìç –≠—Ç–∞–ø 10: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–¶–µ–ª—å**: –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

**–®–∞–≥–∏**:

1. **–ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ unit-—Ç–µ—Å—Ç—ã
   - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
   - [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ WPF
   - [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Console

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
   - [ ] –ò–∑–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
   - [ ] –°—Ä–∞–≤–Ω–∏—Ç—å —Å –∏—Å—Ö–æ–¥–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π
   - [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å README
   - [ ] –û–±–Ω–æ–≤–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
   - [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –Ω–æ–≤—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º

4. **Code review**
   - [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ–≤—å—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∑–∞–º–µ—á–∞–Ω–∏—è

5. **–°–ª–∏—è–Ω–∏–µ –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É**
   - [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
   - [ ] –°–æ–∑–¥–∞—Ç—å Pull Request
   - [ ] –ü–æ–ª—É—á–∏—Ç—å –æ–¥–æ–±—Ä–µ–Ω–∏–µ
   - [ ] –°–ª–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**:
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ Code review –ø—Ä–æ–π–¥–µ–Ω
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–ª–∏—Ç—ã –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: 2-4 —á–∞—Å–∞

**–†–∏—Å–∫–∏**: –ù–∏–∑–∫–∏–µ (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)

---

## üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —ç—Ç–∞–ø–æ–≤

| –≠—Ç–∞–ø | –ù–∞–∑–≤–∞–Ω–∏–µ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –í—Ä–µ–º—è | –†–∏—Å–∫–∏ |
|------|----------|-----------|-------|-------|
| 1 | –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π | 2-4 —á | –ù–∏–∑–∫–∏–µ |
| 2 | –°–æ–∑–¥–∞–Ω–∏–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π | 2-3 —á | –ù–∏–∑–∫–∏–µ |
| 3 | –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Game ‚Üí GameEngine (CQRS) | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π | 6-8 —á | –°—Ä–µ–¥–Ω–∏–µ |
| 4 | –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∏–∫–∏ —Ö–æ–¥–æ–≤ | üü° –í—ã—Å–æ–∫–∏–π | 4-6 —á | –°—Ä–µ–¥–Ω–∏–µ |
| 5 | –ú–µ—Ç–æ–¥—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä—ã | üü° –í—ã—Å–æ–∫–∏–π | 4-6 —á | –°—Ä–µ–¥–Ω–∏–µ |
| 6 | –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è BoardState | üü° –í—ã—Å–æ–∫–∏–π | 3-4 —á | –°—Ä–µ–¥–Ω–∏–µ |
| 7 | –°–æ–∑–¥–∞–Ω–∏–µ IGameService | üü° –í—ã—Å–æ–∫–∏–π | 2-3 —á | –ù–∏–∑–∫–∏–µ |
| 8 | –ú–∏–≥—Ä–∞—Ü–∏—è WPF | üü° –í—ã—Å–æ–∫–∏–π | 2-3 —á | –°—Ä–µ–¥–Ω–∏–µ |
| 9 | –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ –∫–æ–¥–∞ | üü¢ –°—Ä–µ–¥–Ω–∏–π | 1-2 —á | –ù–∏–∑–∫–∏–µ |
| 10 | –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π | 2-4 —á | –ù–∏–∑–∫–∏–µ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏**: 31-48 —á–∞—Å–æ–≤ (4-6 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π)

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

| ‚Ññ | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|-------------|----------|
| 1 | ‚úÖ **–ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏** | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–∫—Ä—ã—Ç—ã, –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é |
| 2 | ‚úÖ **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º** | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –∑–∞–º–µ–Ω–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (bitboards) –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ WPF |
| 3 | ‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** | –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è, –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –ø–µ—Ä–µ—Å—á–µ—Ç–æ–≤ |
| 4 | ‚úÖ **–ê–±—Å—Ç—Ä–∞–∫—Ü–∏–∏** | `IGameService` –∏ `IGameEngine` –ø–æ–∑–≤–æ–ª—è—é—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å |
| 5 | ‚úÖ **–ú–µ–Ω—å—à–µ —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏** | WPF –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ |
| 6 | ‚úÖ **–ü—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞** | –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ |
| 7 | ‚úÖ **–ë—É–¥—É—â–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** | –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å bitboards, –Ω–µ —Ç—Ä–æ–≥–∞—è WPF |

---

## üîÆ –ë—É–¥—É—â–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–Ω–µ —Å–µ–π—á–∞—Å)

### Bitboards

–ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ bitboards:

```csharp
// –ë—É–¥—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
public class BitboardRepresentation : IBoardRepresentation
{
    private ulong[] whitePieces; // Bitboard –¥–ª—è –±–µ–ª—ã—Ö —Ñ–∏–≥—É—Ä
    private ulong[] blackPieces; // Bitboard –¥–ª—è —á–µ—Ä–Ω—ã—Ö —Ñ–∏–≥—É—Ä
    
    // –ë—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ –±–∏—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
    public IPieceInfo GetPieceAt(Position position) { /* ... */ }
    public IReadOnlyList<Position> GetValidMoves(Position from) { /* ... */ }
}
```

**–í–∞–∂–Ω–æ**: WPF –Ω–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Ç.–∫. –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IGameService` ‚Üí `IGameEngine` ‚Üí `IBoardRepresentation`

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

1. **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ View** - –Ω–∏–∫–∞–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç WPF/Console
2. **View –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ –±–∏–±–ª–∏–æ—Ç–µ–∫—É** - —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
3. **–ê–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ** - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º
4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∏–∑–±–µ–≥–∞–µ–º –ª–∏—à–Ω–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
5. **–ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è** - —Å–∫—Ä—ã–≤–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º

1. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é**
2. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç**
3. **–†–∞–±–æ—Ç–∞–π—Ç–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≤–µ—Ç–∫–µ**
4. **–ö–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞**

### –í–æ –≤—Ä–µ–º—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

1. **–ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ —ç—Ç–∞–ø—ã** - –æ–Ω–∏ –≤—ã—Å—Ç—Ä–æ–µ–Ω—ã –≤ –ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ
2. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞** - –Ω–µ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–π—Ç–µ –ø—Ä–æ–±–ª–µ–º—ã
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞–ª–µ–Ω—å–∫–∏–µ –∫–æ–º–º–∏—Ç—ã** - –ª–µ–≥—á–µ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è**

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

1. **–ü—Ä–æ–≤–µ–¥–∏—Ç–µ code review** - —Å–≤–µ–∂–∏–π –≤–∑–≥–ª—è–¥ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã
2. **–û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** - –≤–∞–∂–Ω–æ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π
4. **–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –æ–ø—ã—Ç–æ–º** - –ø–æ–º–æ–∂–µ—Ç –∫–æ–º–∞–Ω–¥–µ –≤ –±—É–¥—É—â–∏—Ö —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞—Ö

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤ (WPF + ChessLib)

–ü–æ–ª–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –≤—Å–µ—Ö –∫–ª–∞—Å—Å–æ–≤ –≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:

```mermaid
classDiagram
    direction TB
    
    %% ============================================
    %% WPF LAYER - Presentation
    %% ============================================
    
    class MainWindow {
        +MainViewModel ViewModel
        +ShowPanel()
        +HidePanel()
    }
    
    class MainViewModel {
        +GameViewModel Game
        +BoardViewModel Board
        +TimerViewModel Timer
        +CapturedPiecesViewModel CapturedPieces
        +GameStorageViewModel GameStorage
        +MoveHistoryViewModel MoveHistory
        +SettingsViewModel Settings
        +PanelManagementViewModel Panels
        +Brush DarkSquareColor
        +Brush LightSquareColor
    }
    
    class GameViewModel {
        -IGameService gameService
        -BoardViewModel board
        -SoundService soundService
        +HandleCellClick(Position)
        +UpdateViewFromGameState()
        +GetStateFromPiece(IPiece) CellUIState
        +string Fen
        +string MoveHistory
    }
    
    class BoardViewModel {
        -CellViewModel[,] cells
        +CellUIState this[int, int]
        +UpdateFromState(IGameState)
        +IEnumerable~CellViewModel~ GetEnumerator()
    }
    
    class CellViewModel {
        +Position Position
        +CellUIState State
        +bool Active
        +bool AvailableMove
    }
    
    class TimerViewModel {
        +TimeSpan WhiteTime
        +TimeSpan BlackTime
        +void Start()
        +void Pause()
        +void Reset()
    }
    
    class CapturedPiecesViewModel {
        +ObservableCollection~IPieceInfo~ WhiteCaptured
        +ObservableCollection~IPieceInfo~ BlackCaptured
        +UpdateFromMoveHistory(Func~IPiece, CellUIState~)
    }
    
    class GameStorageViewModel {
        -IGameService gameService
        -GameStorageService storageService
        +ObservableCollection~GameRecord~ SavedGames
        +GameRecord SelectedGame
        +ICommand SaveGameCommand
        +ICommand LoadSelectedGameCommand
    }
    
    class MoveHistoryViewModel {
        -IGameService gameService
        +ObservableCollection~MoveDisplayItem~ MoveHistoryItems
        +bool IsGameLoaded
        +void LoadGame(List~string~)
        +void NavigateToMove(int)
    }
    
    class SettingsViewModel {
        +ColorScheme CurrentScheme
        +PanelPosition PanelPosition
        +bool ShowAvailableMoves
        +event OnColorSchemeChanged
        +event OnPanelPositionChanged
    }
    
    class PanelManagementViewModel {
        +bool IsGamePanelOpen
        +bool IsSettingsPanelOpen
        +void ToggleGamePanel()
        +void ToggleSettingsPanel()
    }
    
    class HistoricalGamesViewModel {
        +ObservableCollection~HistoricalGame~ Games
        +HistoricalGame SelectedHistoricalGame
        +Action~HistoricalGame~ OnGameLoadRequested
    }
    
    %% ============================================
    %% APPLICATION LAYER
    %% ============================================
    
    class IGameService {
        <<interface>>
        +MoveResult MakeMove(Position, Position)
        +IReadOnlyList~Position~ GetValidMoves(Position)
        +IGameState GetState()
        +void StartNewGame()
        +string GetFen()
        +string GetMoveHistory()
    }
    
    class GameService {
        -IGameEngine gameEngine
        +MoveResult MakeMove(Position, Position)
        +IReadOnlyList~Position~ GetValidMoves(Position)
        +IGameState GetState()
        +void StartNewGame()
    }
    
    %% ============================================
    %% CHESSLIB DOMAIN LAYER
    %% ============================================
    
    class IGameEngine {
        <<interface>>
        +MoveResult MakeMove(Position, Position)
        +IReadOnlyList~Position~ GetValidMoves(Position)
        +IGameState GetState()
        +void StartNewGame()
        +string GetFen()
        +string GetMoveHistory()
        +void LoadFromPgn(string)
        +void LoadFromFen(string)
        +void LoadFromState(IGameState)
    }
    
    class GameEngine {
        -Game game
        -IGameStateCache cache
        -IMoveCalculator moveCalculator
        +MoveResult MakeMove(Position, Position)
        +IReadOnlyList~Position~ GetValidMoves(Position)
        +IGameState GetState()
    }
    
    class IGameState {
        <<interface>>
        +PieceColor CurrentPlayerColor
        +bool IsCheck
        +bool IsCheckmate
        +bool IsGameOver
        +IReadOnlyList~IPieceInfo~ Pieces
    }
    
    class GameState {
        +PieceColor CurrentPlayerColor
        +bool IsCheck
        +bool IsCheckmate
        +bool IsGameOver
        +IReadOnlyList~IPieceInfo~ Pieces
    }
    
    class IGameStateCache {
        <<interface>>
        +IGameState GetState()
        +void Invalidate()
        +void UpdateAfterMove(Move)
    }
    
    class GameStateCache {
        -IGameState cachedState
        -Dictionary~Position, List~Position~~ cachedMoves
        +IGameState GetState()
        +void Invalidate()
    }
    
    class IMoveCalculator {
        <<interface>>
        +List~Position~ GetValidMoves(IPiece, IGameState)
    }
    
    class MoveCalculator {
        -IMoveStrategyRegistry strategyRegistry
        -ISpecialMoveStrategy[] specialStrategies
        -IMoveValidator moveValidator
        +List~Position~ GetValidMoves(IPiece, IGameState)
    }
    
    class IMoveStrategy {
        <<interface>>
        +PieceType PieceType
        +List~Position~ GetPossibleMoves(IPiece, IBoardQuery)
        +List~Position~ GetPossibleCaptures(IPiece, IBoardQuery)
    }
    
    class IMoveStrategyRegistry {
        <<interface>>
        +IMoveStrategy GetStrategy(PieceType)
    }
    
    class MoveStrategyRegistry {
        -Dictionary~PieceType, IMoveStrategy~ strategies
        +IMoveStrategy GetStrategy(PieceType)
    }
    
    class PawnMoveStrategy {
        +List~Position~ GetPossibleMoves(IPiece, IBoardQuery)
        +List~Position~ GetPossibleCaptures(IPiece, IBoardQuery)
    }
    
    class KingMoveStrategy {
        +List~Position~ GetPossibleMoves(IPiece, IBoardQuery)
        +List~Position~ GetPossibleCaptures(IPiece, IBoardQuery)
    }
    
    class QueenMoveStrategy {
        +List~Position~ GetPossibleMoves(IPiece, IBoardQuery)
        +List~Position~ GetPossibleCaptures(IPiece, IBoardQuery)
    }
    
    class RookMoveStrategy {
        +List~Position~ GetPossibleMoves(IPiece, IBoardQuery)
        +List~Position~ GetPossibleCaptures(IPiece, IBoardQuery)
    }
    
    class BishopMoveStrategy {
        +List~Position~ GetPossibleMoves(IPiece, IBoardQuery)
        +List~Position~ GetPossibleCaptures(IPiece, IBoardQuery)
    }
    
    class KnightMoveStrategy {
        +List~Position~ GetPossibleMoves(IPiece, IBoardQuery)
        +List~Position~ GetPossibleCaptures(IPiece, IBoardQuery)
    }
    
    class ISpecialMoveStrategy {
        <<interface>>
        +List~Position~ GetSpecialMoves(IPiece, IGameState)
    }
    
    class EnPassantStrategy {
        +List~Position~ GetSpecialMoves(IPiece, IGameState)
    }
    
    class CastlingStrategy {
        +List~Position~ GetSpecialMoves(IPiece, IGameState)
    }
    
    class IBoardQuery {
        <<interface>>
        +IPieceInfo GetPieceAt(Position)
        +bool IsCellFree(Position)
        +bool IsCellAttacked(Position, PieceColor)
    }
    
    class BoardQuery {
        -IGameState state
        +IPieceInfo GetPieceAt(Position)
        +bool IsCellFree(Position)
        +bool IsCellAttacked(Position, PieceColor)
    }
    
    class IBoardState {
        <<interface>>
        +IPieceInfo GetPieceAt(Position)
        +bool IsCellFree(Position)
        +IReadOnlyList~Position~ GetAttackedCells(PieceColor)
    }
    
    class BoardState {
        -IBoardRepresentation representation
        +IPieceInfo GetPieceAt(Position)
        +bool IsCellFree(Position)
    }
    
    class IBoardRepresentation {
        <<interface>>
        +IPieceInfo GetPieceAt(Position)
        +void SetPieceAt(Position, IPieceInfo)
        +void ClearCell(Position)
        +void UpdateAfterMove(Move)
    }
    
    class ArrayBoardRepresentation {
        -IPieceInfo[,] board
        +IPieceInfo GetPieceAt(Position)
        +void UpdateAfterMove(Move)
    }
    
    class BitboardRepresentation {
        -ulong[] whitePieces
        -ulong[] blackPieces
        +IPieceInfo GetPieceAt(Position)
        +void UpdateAfterMove(Move)
    }
    
    class IPieceInfo {
        <<interface>>
        +PieceType Type
        +PieceColor Color
        +Position Position
    }
    
    class PieceInfo {
        +PieceType Type
        +PieceColor Color
        +Position Position
    }
    
    class IPiece {
        <<interface>>
        +PieceType Type
        +PieceColor Color
        +Position Position
        +bool IsDead
    }
    
    class IMoveValidator {
        <<interface>>
        +bool IsValidMove(IPiece, Position, IGameState)
        +List~Position~ FilterValidMoves(IPiece, List~Position~, IGameState)
    }
    
    class MoveValidator {
        +bool IsValidMove(IPiece, Position, IGameState)
        +List~Position~ FilterValidMoves(IPiece, List~Position~, IGameState)
    }
    
    class IMoveExecutor {
        <<interface>>
        +MoveResult ExecuteMove(IPiece, Position, IGameState)
        +MoveResult ExecuteEnPassant(Pawn, Position, Pawn, IGameState)
        +MoveResult ExecuteCastling(King, Rook, CastleType, IGameState)
    }
    
    class MoveExecutor {
        +MoveResult ExecuteMove(IPiece, Position, IGameState)
        +MoveResult ExecuteEnPassant(Pawn, Position, Pawn, IGameState)
        +MoveResult ExecuteCastling(King, Rook, CastleType, IGameState)
    }
    
    class MoveResult {
        +bool Success
        +MoveType MoveType
        +string ErrorMessage
        +IPieceInfo CapturedPiece
        +bool IsCheck
        +bool IsCheckmate
    }
    
    %% ============================================
    %% WPF SERVICES
    %% ============================================
    
    class SoundService {
        +void PlayMoveSound()
        +void PlayCaptureSound()
        +void PlayCheckSound()
    }
    
    class GameStorageService {
        +void SaveGame(GameRecord)
        +List~GameRecord~ LoadSavedGames()
        +void ImportGames(string)
    }
    
    class PgnService {
        +string GeneratePgn(IGameState)
        +List~string~ ParsePgnMoves(string)
        +Dictionary~string, string~ ParsePgnHeaders(string)
    }
    
    %% ============================================
    %% CONNECTIONS - WPF Layer
    %% ============================================
    
    MainWindow --> MainViewModel
    MainViewModel --> GameViewModel
    MainViewModel --> BoardViewModel
    MainViewModel --> TimerViewModel
    MainViewModel --> CapturedPiecesViewModel
    MainViewModel --> GameStorageViewModel
    MainViewModel --> MoveHistoryViewModel
    MainViewModel --> SettingsViewModel
    MainViewModel --> PanelManagementViewModel
    MainViewModel --> HistoricalGamesViewModel
    
    GameViewModel --> IGameService : ‚úÖ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    GameViewModel --> BoardViewModel
    GameViewModel --> SoundService
    BoardViewModel --> CellViewModel
    
    GameStorageViewModel --> IGameService
    GameStorageViewModel --> GameStorageService
    MoveHistoryViewModel --> IGameService
    
    %% ============================================
    %% CONNECTIONS - Application Layer
    %% ============================================
    
    IGameService <|.. GameService : implements
    GameService --> IGameEngine : ‚úÖ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    
    %% ============================================
    %% CONNECTIONS - Domain Layer
    %% ============================================
    
    IGameEngine <|.. GameEngine : implements
    GameEngine --> IGameStateCache
    GameEngine --> IMoveCalculator
    GameEngine --> IGameState : returns
    
    IGameStateCache <|.. GameStateCache : implements
    IGameState <|.. GameState : implements
    
    IMoveCalculator <|.. MoveCalculator : implements
    MoveCalculator --> IMoveStrategyRegistry
    MoveCalculator --> ISpecialMoveStrategy
    MoveCalculator --> IMoveValidator
    
    IMoveStrategyRegistry <|.. MoveStrategyRegistry : implements
    IMoveStrategyRegistry --> IMoveStrategy : provides
    
    IMoveStrategy <|.. PawnMoveStrategy : implements
    IMoveStrategy <|.. KingMoveStrategy : implements
    IMoveStrategy <|.. QueenMoveStrategy : implements
    IMoveStrategy <|.. RookMoveStrategy : implements
    IMoveStrategy <|.. BishopMoveStrategy : implements
    IMoveStrategy <|.. KnightMoveStrategy : implements
    
    ISpecialMoveStrategy <|.. EnPassantStrategy : implements
    ISpecialMoveStrategy <|.. CastlingStrategy : implements
    
    IMoveStrategy --> IBoardQuery : uses
    IBoardQuery <|.. BoardQuery : implements
    BoardQuery --> IGameState
    
    IBoardState <|.. BoardState : implements
    BoardState --> IBoardRepresentation
    IBoardRepresentation <|.. ArrayBoardRepresentation : implements
    IBoardRepresentation <|.. BitboardRepresentation : implements
    
    IMoveValidator <|.. MoveValidator : implements
    IMoveExecutor <|.. MoveExecutor : implements
    
    GameState --> IPieceInfo
    IPieceInfo <|.. PieceInfo : implements
    
    %% ============================================
    %% STYLING
    %% ============================================
    
    style MainWindow fill:#4a90e2,stroke:#2c5aa0,stroke-width:2px,color:#ffffff
    style MainViewModel fill:#4a90e2,stroke:#2c5aa0,stroke-width:2px,color:#ffffff
    style GameViewModel fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style BoardViewModel fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style CellViewModel fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    
    style IGameService fill:#2f9e44,stroke:#1e7e34,stroke-width:3px,color:#ffffff
    style GameService fill:#2f9e44,stroke:#1e7e44,stroke-width:2px,color:#ffffff
    
    style IGameEngine fill:#2f9e44,stroke:#1e7e34,stroke-width:3px,color:#ffffff
    style GameEngine fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IGameState fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IGameStateCache fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IMoveCalculator fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IMoveStrategy fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style ISpecialMoveStrategy fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IBoardQuery fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IBoardState fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IBoardRepresentation fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style IPieceInfo fill:#2f9e44,stroke:#1e7e34,stroke-width:2px,color:#ffffff
    style BitboardRepresentation fill:#6c757d,stroke:#495057,stroke-width:2px,color:#ffffff
```

### üìù –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏—Ç–æ–≥–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**WPF Layer (Presentation)**:
- ‚úÖ –í—Å–µ ViewModels —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å UI –ª–æ–≥–∏–∫–æ–π
- ‚úÖ `GameViewModel` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IGameService` (–Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ –±–∏–±–ª–∏–æ—Ç–µ–∫—É)
- ‚úÖ `BoardViewModel` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IGameState` –Ω–∞–ø—Ä—è–º—É—é (–Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è)
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É ViewModels

**Application Layer**:
- ‚úÖ `IGameService` - –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è WPF
- ‚úÖ `GameService` - –ø—Ä–æ—Å—Ç–∞—è –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ `IGameEngine`
- ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è WPF –æ—Ç –¥–µ—Ç–∞–ª–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

**Domain Layer (ChessLib)**:
- ‚úÖ `IGameEngine` - –≥–ª–∞–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- ‚úÖ `GameEngine` - –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ `IMoveStrategy` - Strategy Pattern –¥–ª—è –≤—Å–µ—Ö —Ñ–∏–≥—É—Ä
- ‚úÖ `ISpecialMoveStrategy` - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ö–æ–¥—ã (En Passant, —Ä–æ–∫–∏—Ä–æ–≤–∫–∞)
- ‚úÖ `IGameStateCache` - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ `IBoardQuery` - –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å–∫–∏ –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- ‚úÖ `IBoardRepresentation` - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ bitboards

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è - WPF –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å - –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ WPF
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ Strategy Pattern
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å - –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å–∫–∏
